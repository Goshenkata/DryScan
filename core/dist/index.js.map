{"version":3,"sources":["../src/DryScan.ts","../src/const.ts","../src/IndexUnitExtractor.ts","../src/extractors/java.ts","../src/config/indexConfig.ts","../src/config/configStore.ts","../src/config/dryconfig.ts","../src/Gitignore.ts","../src/db/DryScanDatabase.ts","../src/db/entities/FileEntity.ts","../src/db/entities/IndexUnitEntity.ts","../src/services/RepositoryInitializer.ts","../src/services/EmbeddingService.ts","../../node_modules/whatwg-fetch/fetch.js","../../node_modules/ollama/dist/browser.mjs","../../node_modules/@langchain/ollama/src/embeddings.ts","../src/services/UpdateService.ts","../src/DryScanUpdater.ts","../src/services/DuplicationCache.ts","../src/services/DuplicateService.ts","../src/services/ExclusionService.ts","../src/services/PairingService.ts"],"sourcesContent":["import upath from \"upath\";\nimport fs from \"fs/promises\";\nimport { DuplicateAnalysisResult, DuplicateReport } from \"./types\";\nimport { DRYSCAN_DIR, INDEX_DB } from \"./const\";\nimport { defaultExtractors, IndexUnitExtractor } from \"./IndexUnitExtractor\";\nimport { DryScanDatabase } from \"./db/DryScanDatabase\";\nimport { RepositoryInitializer, InitOptions as InitServiceOptions } from \"./services/RepositoryInitializer\";\nimport { UpdateService } from \"./services/UpdateService\";\nimport { DuplicateService } from \"./services/DuplicateService\";\nimport { ExclusionService } from \"./services/ExclusionService\";\nimport { DryScanServiceDeps } from \"./services/types\";\nimport { configStore } from \"./config/configStore\";\nimport { DryConfig } from \"./types\";\nimport { PairingService } from \"./services/PairingService\";\n\nexport type InitOptions = InitServiceOptions;\n\n\nexport class DryScan {\n  repoPath: string;\n  private readonly extractor: IndexUnitExtractor;\n  private db: DryScanDatabase;\n  private readonly services: {\n    initializer: RepositoryInitializer;\n    updater: UpdateService;\n    duplicate: DuplicateService;\n    exclusion: ExclusionService;\n  };\n  private readonly serviceDeps: DryScanServiceDeps;\n\n  constructor(\n    repoPath: string,\n    extractor?: IndexUnitExtractor,\n    db?: DryScanDatabase\n  ) {\n    this.repoPath = repoPath;\n    this.extractor = extractor ?? new IndexUnitExtractor(repoPath, defaultExtractors(repoPath));\n    this.db = db ?? new DryScanDatabase();\n\n    this.serviceDeps = {\n      repoPath: this.repoPath,\n      db: this.db,\n      extractor: this.extractor,\n      pairing: new PairingService(this.extractor),\n    };\n\n    const exclusion = new ExclusionService(this.serviceDeps);\n    this.services = {\n      initializer: new RepositoryInitializer(this.serviceDeps, exclusion),\n      updater: new UpdateService(this.serviceDeps, exclusion),\n      duplicate: new DuplicateService(this.serviceDeps),\n      exclusion,\n    };\n  }\n\n  /**\n   * Initializes the DryScan repository with a 3-phase analysis:\n   * Phase 1: Extract and save all functions\n   * Phase 2: Resolve and save internal dependencies\n   * Phase 3: Compute and save semantic embeddings\n   */\n  async init(options?: InitOptions): Promise<void> {\n    console.log(`[DryScan] Initializing repository at ${this.repoPath}`);\n    console.log(\"[DryScan] Preparing database and cache...\");\n    await configStore.init(this.repoPath);\n    await this.ensureDatabase();\n    if (await this.isInitialized()) {\n      console.log(\"[DryScan] Repository already initialized; skipping full init.\");\n      return;\n    }\n    console.log(\"[DryScan] Starting initial scan (may take a moment)...\");\n    await this.services.initializer.init(options);\n    console.log(\"[DryScan] Initial scan complete.\");\n  }\n\n  /**\n   * Updates the index by detecting changed, new, and deleted files.\n   * Only reprocesses units in changed files for efficiency.\n   * Delegates to DryScanUpdater module for implementation.\n   * \n   * Update process:\n   * 1. List all current source files in repository\n   * 2. For each file, check if it's new, changed, or unchanged (via mtime + checksum)\n   * 3. Remove old units from changed/deleted files\n   * 4. Extract and save units from new/changed files\n   * 5. Recompute internal dependencies for affected units\n   * 6. Recompute embeddings for affected units\n   * 7. Update file tracking metadata\n   */\n  async updateIndex(): Promise<void> {\n    console.log(`[DryScan] Updating index at ${this.repoPath}...`);\n    console.log(\"[DryScan] Checking for file changes...\");\n    const start = Date.now();\n    await this.ensureDatabase();\n    await this.services.updater.updateIndex();\n    const duration = Date.now() - start;\n    console.log(`[DryScan] Index update complete. Took ${duration}ms.`);\n  }\n\n\n  /**\n   * Runs duplicate detection and returns a normalized report payload ready for persistence or display.\n   */\n  async buildDuplicateReport(): Promise<DuplicateReport> {\n    const config = await this.loadConfig();\n    const analysis = await this.findDuplicates(config);\n    return {\n      version: 1,\n      generatedAt: new Date().toISOString(),\n      threshold: config.threshold,\n      grade: analysis.score.grade,\n      score: analysis.score,\n      duplicates: analysis.duplicates,\n    };\n  }\n\n  /**\n   * Finds duplicate code blocks using cosine similarity on embeddings.\n   * Automatically updates the index before searching to ensure results are current.\n   * Compares all function pairs and returns groups with similarity above the configured threshold.\n   *\n   * @returns Analysis result with duplicate groups and duplication score\n   */\n  private async findDuplicates(config: DryConfig): Promise<DuplicateAnalysisResult> {\n    console.log(`[DryScan] Finding duplicates (threshold: ${config.threshold})...`);\n    await this.ensureDatabase();\n\n    console.log(\"[DryScan] Updating index...\");\n    const updateStart = Date.now();\n    await this.updateIndex();\n    const updateDuration = Date.now() - updateStart;\n    console.log(`[DryScan] Index update  took ${updateDuration}ms.`);\n\n    console.log(\"[DryScan] Detecting duplicates...\");\n    const dupStart = Date.now();\n    const result = await this.services.duplicate.findDuplicates(config);\n    const dupDuration = Date.now() - dupStart;\n    console.log(`[DryScan] Duplicate detection took ${dupDuration}ms.`);\n\n    return result;\n  }\n\n  /**\n   * Cleans excludedPairs entries that no longer match any indexed units.\n   * Runs an update first to ensure the index reflects current code.\n   */\n  async cleanExclusions(): Promise<{ removed: number; kept: number }> {\n    await this.updateIndex();\n    return this.services.exclusion.cleanExclusions();\n  }\n\n  private async ensureDatabase(): Promise<void> {\n    if (this.db.isInitialized()) return;\n    const dbPath = upath.join(this.repoPath, DRYSCAN_DIR, INDEX_DB);\n    await fs.mkdir(upath.dirname(dbPath), { recursive: true });\n    await this.db.init(dbPath);\n  }\n\n  private async loadConfig(): Promise<DryConfig> {\n    return configStore.get(this.repoPath);\n  }\n\n  private async isInitialized(): Promise<boolean> {\n    if (!this.db.isInitialized()) return false;\n    const unitCount = await this.db.countUnits();\n    const initialized = unitCount > 0;\n    console.log(`[DryScan] Initialization check: ${unitCount} indexed units`);\n    return initialized;\n  }\n}\n","export const DRYSCAN_DIR = \".dry\";\nexport const INDEX_DB = \"index.db\";\nexport const REPORTS_DIR = \"reports\";\nexport const FILE_CHECKSUM_ALGO = \"md5\";\nexport const BLOCK_HASH_ALGO = \"sha1\";","import path from \"path\";\nimport type { Stats } from \"fs\";\nimport fs from \"fs/promises\";\nimport upath from \"upath\";\nimport crypto from \"node:crypto\";\nimport debug from \"debug\";\nimport { glob } from \"glob-gitignore\";\nimport { IndexUnit } from \"./types\";\nimport { LanguageExtractor } from \"./extractors/LanguageExtractor\";\nimport { JavaExtractor } from \"./extractors/java\";\nimport { FILE_CHECKSUM_ALGO } from \"./const\";\nimport { configStore } from \"./config/configStore\";\nimport { DryConfig } from \"./types\";\nimport { Gitignore } from \"./Gitignore\"\nimport { Ignore } from \"ignore\";\n\nconst log = debug(\"DryScan:Extractor\");\n\nexport type { LanguageExtractor } from \"./extractors/LanguageExtractor\";\n/**\n * Returns the default set of language extractors supported by DryScan.\n * Extend/override by passing custom extractors into the IndexUnitExtractor constructor.\n */\nexport function defaultExtractors(repoPath: string): LanguageExtractor[] {\n  return [new JavaExtractor(repoPath)];\n}\n\n/**\n * Extracts and indexes code units (classes, functions, blocks) for a repository.\n * Owns shared file-system helpers and delegates language-specific parsing to LanguageExtractors.\n */\nexport class IndexUnitExtractor {\n  private readonly root: string;\n  readonly extractors: LanguageExtractor[];\n  private readonly gitignore: Gitignore;\n\n  constructor(\n    rootPath: string,\n    extractors?: LanguageExtractor[]\n  ) {\n    this.root = rootPath;\n    this.extractors = extractors ?? defaultExtractors(rootPath);\n    this.gitignore = new Gitignore(this.root);\n    log(\"Initialized extractor for %s\", this.root);\n  }\n\n  /**\n   * Lists all supported source files from a path. Honors exclusion globs from config.\n   */\n  async listSourceFiles(dirPath: string): Promise<string[]> {\n    const target = await this.resolveTarget(dirPath);\n    const config = await this.loadConfig();\n    const ignoreMatcher = await this.gitignore.buildMatcher(config);\n\n    if (target.stat.isFile()) {\n      return this.filterSingleFile(target.baseRel, ignoreMatcher);\n    }\n\n    const matches = await this.globSourceFiles(target.baseRel);\n    return this.filterSupportedFiles(matches, ignoreMatcher);\n  }\n\n  /**\n   * Computes MD5 checksum of file content to track changes.\n   */\n  async computeChecksum(filePath: string): Promise<string> {\n    const fullPath = path.isAbsolute(filePath)\n      ? filePath\n      : path.join(this.root, filePath);\n\n    const content = await fs.readFile(fullPath, \"utf8\");\n    return crypto.createHash(FILE_CHECKSUM_ALGO).update(content).digest(\"hex\");\n  }\n\n  /**\n   * Scans a file or directory and extracts indexable units using the matching LanguageExtractor.\n   * The returned units have repo-relative file paths and no embedding attached.\n   */\n  async scan(targetPath: string): Promise<IndexUnit[]> {\n    const fullPath = path.isAbsolute(targetPath)\n      ? targetPath\n      : path.join(this.root, targetPath);\n\n    const stat = await fs.stat(fullPath).catch(() => null);\n    if (!stat) {\n      throw new Error(`Path not found: ${fullPath}`);\n    }\n\n    if (stat.isDirectory()) {\n      log(\"Scanning directory %s\", fullPath);\n      return this.scanDirectory(fullPath);\n    }\n\n    return this.scanFile(fullPath);\n  }\n\n\n  /**\n   * Scans a directory recursively, extracting units from supported files while honoring exclusions.\n   */\n  private async scanDirectory(dir: string): Promise<IndexUnit[]> {\n    const out: IndexUnit[] = [];\n    const relDir = this.relPath(dir);\n    const files = await this.listSourceFiles(relDir);\n    for (const relFile of files) {\n      const absFile = path.join(this.root, relFile);\n      const extracted = await this.tryScanSupportedFile(absFile);\n      out.push(...extracted);\n    }\n    return out;\n  }\n\n  /**\n   * Scans a single file and extracts supported units.\n   */\n  private async scanFile(filePath: string): Promise<IndexUnit[]> {\n    return this.tryScanSupportedFile(filePath, true);\n  }\n\n  /**\n   * Extracts units from a supported file.\n   * Optionally throws when the file type is unsupported (used when scanning an explicit file).\n   */\n  private async tryScanSupportedFile(filePath: string, throwOnUnsupported = false): Promise<IndexUnit[]> {\n    const extractor = this.extractors.find(ex => ex.supports(filePath));\n    if (!extractor) {\n      if (throwOnUnsupported) {\n        throw new Error(`Unsupported file type: ${filePath}`);\n      }\n      return [];\n    }\n    const rel = this.relPath(filePath);\n    if (await this.shouldExclude(rel)) {\n      log(\"Skipping excluded file %s\", rel);\n      return [];\n    }\n    const source = await fs.readFile(filePath, \"utf8\");\n    const units = await extractor.extractFromText(rel, source);\n    log(\"Extracted %d units from %s\", units.length, rel);\n    return units.map(unit => ({\n      ...unit,\n      filePath: rel,\n      embedding: undefined,\n    }));\n  }\n\n  /**\n   * Converts an absolute path to a repo-relative, normalized (POSIX-style) path.\n   * This keeps paths stable across platforms and consistent in the index/DB.\n   */\n  private relPath(absPath: string): string {\n    return this.normalizeRelPath(upath.relative(this.root, absPath));\n  }\n\n  /**\n   * Returns true if a repo-relative path matches any configured exclusion glob.\n   */\n  private async shouldExclude(relPath: string): Promise<boolean> {\n    const config = await this.loadConfig();\n    const ignoreMatcher = await this.gitignore.buildMatcher(config);\n    return ignoreMatcher.ignores(this.normalizeRelPath(relPath));\n  }\n\n  private async loadConfig(): Promise<DryConfig> {\n    return await configStore.get(this.root);\n  }\n\n  /**\n   * Normalizes repo-relative paths and strips leading \"./\" to keep matcher inputs consistent.\n   */\n  private normalizeRelPath(relPath: string): string {\n    const normalized = upath.normalizeTrim(relPath);\n    return normalized.startsWith(\"./\") ? normalized.slice(2) : normalized;\n  }\n\n  private async resolveTarget(dirPath: string): Promise<{ fullPath: string; baseRel: string; stat: Stats; }> {\n    const fullPath = path.isAbsolute(dirPath) ? dirPath : path.join(this.root, dirPath);\n    const stat = await fs.stat(fullPath).catch(() => null);\n    if (!stat) {\n      throw new Error(`Path not found: ${fullPath}`);\n    }\n    const baseRel = this.relPath(fullPath);\n    log(\"Listing source files under %s\", fullPath);\n    return { fullPath, baseRel, stat };\n  }\n\n  private async filterSingleFile(baseRel: string, ignoreMatcher: Ignore): Promise<string[]> {\n    const relFile = this.normalizeRelPath(baseRel);\n    if (ignoreMatcher.ignores(relFile)) return [];\n    return this.extractors.some((ex) => ex.supports(relFile)) ? [relFile] : [];\n  }\n\n  private async globSourceFiles(baseRel: string): Promise<string[]> {\n    const pattern = baseRel ? `${baseRel.replace(/\\\\/g, \"/\")}/**/*` : \"**/*\";\n    const matches = await glob(pattern, {\n      cwd: this.root,\n      dot: false,\n      nodir: true,\n    });\n    return matches.map((p: string) => this.normalizeRelPath(p));\n  }\n\n  private filterSupportedFiles(relPaths: string[], ignoreMatcher: Ignore): string[] {\n    return relPaths\n      .filter((relPath: string) => !ignoreMatcher.ignores(relPath))\n      .filter((relPath: string) => this.extractors.some((ex) => ex.supports(relPath)));\n  }\n}\n","import crypto from \"node:crypto\";\nimport Parser from \"tree-sitter\";\nimport Java from \"tree-sitter-java\";\nimport { LanguageExtractor } from \"./LanguageExtractor\";\nimport { IndexUnit, IndexUnitType } from \"../types\";\nimport { indexConfig } from \"../config/indexConfig\";\nimport { DryConfig } from \"../types\";\nimport { configStore } from \"../config/configStore\";\nimport { BLOCK_HASH_ALGO } from \"../const\";\n\nexport class JavaExtractor implements LanguageExtractor {\n  readonly id = \"java\";\n  readonly exts = [\".java\"];\n\n  private parser: Parser;\n  private readonly repoPath: string;\n  private config?: DryConfig;\n\n  constructor(repoPath: string) {\n    this.repoPath = repoPath;\n    this.parser = new Parser();\n    this.parser.setLanguage(Java);\n  }\n\n  supports(filePath: string): boolean {\n    const lower = filePath.toLowerCase();\n    return this.exts.some((ext) => lower.endsWith(ext));\n  }\n\n  async extractFromText(fileRelPath: string, source: string): Promise<IndexUnit[]> {\n    if (!source.trim()) return [];\n\n    this.config = await configStore.get(this.repoPath);\n\n    const tree = this.parser.parse(source);\n    const units: IndexUnit[] = [];\n\n    const visit = (node: Parser.SyntaxNode, currentClass?: IndexUnit) => {\n      if (this.isClassNode(node)) {\n        const className = this.getClassName(node, source) || \"<anonymous>\";\n        if (this.isDtoClass(node, source, className)) {\n          return;\n        }\n        const startLine = node.startPosition.row;\n        const endLine = node.endPosition.row;\n        const classLength = endLine - startLine;\n        const skipClass = this.shouldSkip(IndexUnitType.CLASS, className, classLength);\n        const classId = this.buildId(IndexUnitType.CLASS, className, startLine, endLine);\n        const code = this.stripComments(this.stripClassBody(node, source));\n        const classUnit: IndexUnit = {\n          id: classId,\n          name: className,\n          filePath: fileRelPath,\n          startLine,\n          endLine,\n          code,\n          unitType: IndexUnitType.CLASS,\n          children: [],\n        };\n        if (!skipClass) {\n          units.push(classUnit);\n        }\n\n        for (let i = 0; i < node.namedChildCount; i++) {\n          const child = node.namedChild(i);\n          if (child) visit(child, skipClass ? undefined : classUnit);\n        }\n        return;\n      }\n\n      if (this.isFunctionNode(node)) {\n        const fnUnit = this.buildFunctionUnit(node, source, fileRelPath, currentClass);\n        const fnLength = fnUnit.endLine - fnUnit.startLine;\n        const bodyNode = this.getFunctionBody(node);\n        const skipFunction = this.shouldSkip(IndexUnitType.FUNCTION, fnUnit.name, fnLength);\n\n        if (skipFunction) {\n          return;\n        }\n\n        units.push(fnUnit);\n\n        if (bodyNode) {\n          const blocks = this.extractBlocks(bodyNode, source, fileRelPath, fnUnit);\n          units.push(...blocks);\n        }\n      }\n\n      for (let i = 0; i < node.namedChildCount; i++) {\n        const child = node.namedChild(i);\n        if (child) visit(child, currentClass);\n      }\n    };\n\n    visit(tree.rootNode);\n\n    return units;\n  }\n\n  unitLabel(unit: IndexUnit): string | null {\n    if (unit.unitType === IndexUnitType.CLASS) return unit.filePath;\n    if (unit.unitType === IndexUnitType.FUNCTION) return this.canonicalFunctionSignature(unit);\n    if (unit.unitType === IndexUnitType.BLOCK) return this.normalizedBlockHash(unit);\n    return unit.name;\n  }\n\n  private isClassNode(node: Parser.SyntaxNode): boolean {\n    return node.type === \"class_declaration\";\n  }\n\n  private getClassName(node: Parser.SyntaxNode, source: string): string | null {\n    const nameNode = node.childForFieldName?.(\"name\");\n    return nameNode ? source.slice(nameNode.startIndex, nameNode.endIndex) : null;\n  }\n\n  private isFunctionNode(node: Parser.SyntaxNode): boolean {\n    return node.type === \"method_declaration\" || node.type === \"constructor_declaration\";\n  }\n\n  private getFunctionName(node: Parser.SyntaxNode, source: string, parentClass?: IndexUnit): string | null {\n    const nameNode = node.childForFieldName?.(\"name\");\n    const nameText = nameNode ? source.slice(nameNode.startIndex, nameNode.endIndex) : \"<anonymous>\";\n    return parentClass ? `${parentClass.name}.${nameText}` : nameText;\n  }\n\n  private getFunctionBody(node: Parser.SyntaxNode): Parser.SyntaxNode | null {\n    return node.childForFieldName?.(\"body\") ?? null;\n  }\n\n  private isBlockNode(node: Parser.SyntaxNode): boolean {\n    return node.type === \"block\";\n  }\n\n  private getMethodBodiesForClass(node: Parser.SyntaxNode): Parser.SyntaxNode[] {\n    const bodies: Parser.SyntaxNode[] = [];\n    const classBody = node.children.find(child => child.type === \"class_body\");\n    if (!classBody) return bodies;\n    \n    for (let i = 0; i < classBody.namedChildCount; i++) {\n      const child = classBody.namedChild(i);\n      if (!child) continue;\n      if (child.type === \"method_declaration\" || child.type === \"constructor_declaration\") {\n        const body = child.childForFieldName?.(\"body\");\n        if (body) bodies.push(body);\n      }\n    }\n    return bodies;\n  }\n\n  private canonicalFunctionSignature(unit: IndexUnit): string {\n    const arity = this.extractArity(unit.code);\n    return `${unit.name}(arity:${arity})`;\n  }\n\n  private normalizedBlockHash(unit: IndexUnit): string {\n    const normalized = this.normalizeCode(unit.code);\n    return crypto.createHash(BLOCK_HASH_ALGO).update(normalized).digest(\"hex\");\n  }\n\n  private shouldSkip(unitType: IndexUnitType, name: string, lineCount: number): boolean {\n    if (!this.config) {\n      throw new Error(\"Config not loaded before skip evaluation\");\n    }\n    const config = this.config;\n    const minLines = unitType === IndexUnitType.BLOCK\n      ? Math.max(indexConfig.blockMinLines, config.minBlockLines ?? 0)\n      : config.minLines;\n    const belowMin = minLines > 0 && lineCount < minLines;\n    const trivial = unitType === IndexUnitType.FUNCTION && this.isTrivialFunction(name);\n    return belowMin || trivial;\n  }\n\n  private isTrivialFunction(fullName: string): boolean {\n    const simpleName = fullName.split(\".\").pop() || fullName;\n    const isGetter = /^(get|is)[A-Z]/.test(simpleName);\n    const isSetter = /^set[A-Z]/.test(simpleName);\n    return isGetter || isSetter;\n  }\n\n  private isDtoClass(node: Parser.SyntaxNode, source: string, className: string): boolean {\n    const classBody = node.children.find((child) => child.type === \"class_body\");\n    if (!classBody) return false;\n\n    let hasField = false;\n\n    for (let i = 0; i < classBody.namedChildCount; i++) {\n      const child = classBody.namedChild(i);\n      if (!child) continue;\n\n      if (child.type === \"field_declaration\") {\n        hasField = true;\n        continue;\n      }\n\n      if (child.type.includes(\"annotation\")) {\n        continue;\n      }\n\n      if (child.type === \"method_declaration\" || child.type === \"constructor_declaration\") {\n        const simpleName = this.getSimpleFunctionName(child, source);\n        const fullName = `${className}.${simpleName}`;\n        if (!this.isTrivialFunction(fullName)) {\n          return false;\n        }\n        continue;\n      }\n\n      return false;\n    }\n\n    return hasField;\n  }\n\n  private getSimpleFunctionName(node: Parser.SyntaxNode, source: string): string {\n    const nameNode = node.childForFieldName?.(\"name\");\n    return nameNode ? source.slice(nameNode.startIndex, nameNode.endIndex) : \"<anonymous>\";\n  }\n\n  private buildFunctionUnit(\n    node: Parser.SyntaxNode,\n    source: string,\n    file: string,\n    parentClass?: IndexUnit\n  ): IndexUnit {\n    const name = this.getFunctionName(node, source, parentClass) || \"<anonymous>\";\n    const startLine = node.startPosition.row;\n    const endLine = node.endPosition.row;\n    const id = this.buildId(IndexUnitType.FUNCTION, name, startLine, endLine);\n    const unit: IndexUnit = {\n      id,\n      name,\n      filePath: file,\n      startLine,\n      endLine,\n      code: this.stripComments(source.slice(node.startIndex, node.endIndex)),\n      unitType: IndexUnitType.FUNCTION,\n      parentId: parentClass?.id,\n      parent: parentClass,\n    };\n    if (parentClass) {\n      parentClass.children = parentClass.children || [];\n      parentClass.children.push(unit);\n    }\n    return unit;\n  }\n\n  private extractBlocks(\n    bodyNode: Parser.SyntaxNode,\n    source: string,\n    file: string,\n    parentFunction: IndexUnit\n  ): IndexUnit[] {\n    const blocks: IndexUnit[] = [];\n\n    const visit = (n: Parser.SyntaxNode) => {\n      if (this.isBlockNode(n)) {\n        const startLine = n.startPosition.row;\n        const endLine = n.endPosition.row;\n        const lineCount = endLine - startLine;\n        if (this.shouldSkip(IndexUnitType.BLOCK, parentFunction.name, lineCount)) {\n          return;\n        }\n        if (lineCount >= indexConfig.blockMinLines) {\n          const id = this.buildId(IndexUnitType.BLOCK, parentFunction.name, startLine, endLine);\n          const blockUnit: IndexUnit = {\n            id,\n            name: parentFunction.name,\n            filePath: file,\n            startLine,\n            endLine,\n            code: this.stripComments(source.slice(n.startIndex, n.endIndex)),\n            unitType: IndexUnitType.BLOCK,\n            parentId: parentFunction.id,\n            parent: parentFunction,\n          };\n          parentFunction.children = parentFunction.children || [];\n          parentFunction.children.push(blockUnit);\n          blocks.push(blockUnit);\n        }\n      }\n\n      for (let i = 0; i < n.namedChildCount; i++) {\n        const child = n.namedChild(i);\n        if (child) visit(child);\n      }\n    };\n\n    visit(bodyNode);\n    return blocks;\n  }\n\n  private stripClassBody(node: Parser.SyntaxNode, source: string): string {\n    const classStart = node.startIndex;\n    let code = source.slice(classStart, node.endIndex);\n\n    const methodBodies: Array<{ start: number; end: number }> = [];\n    const candidates = this.getMethodBodiesForClass(node);\n\n    for (const body of candidates) {\n      methodBodies.push({ start: body.startIndex - classStart, end: body.endIndex - classStart });\n    }\n\n    methodBodies.sort((a, b) => b.start - a.start);\n    for (const body of methodBodies) {\n      code = code.slice(0, body.start) + \" { }\" + code.slice(body.end);\n    }\n\n    return code;\n  }\n\n  private buildId(type: IndexUnitType, name: string, startLine: number, endLine: number): string {\n    return `${type}:${name}:${startLine}-${endLine}`;\n  }\n\n  private extractArity(code: string): number {\n    const match = code.match(/^[^{]*?\\(([^)]*)\\)/s);\n    if (!match) return 0;\n    const params = match[1]\n      .split(\",\")\n      .map((p) => p.trim())\n      .filter(Boolean);\n    return params.length;\n  }\n\n  private normalizeCode(code: string): string {\n    const withoutBlockComments = code.replace(/\\/\\*[\\s\\S]*?\\*\\//g, \"\");\n    const withoutLineComments = withoutBlockComments.replace(/\\/\\/[^\\n\\r]*/g, \"\");\n    return withoutLineComments.replace(/\\s+/g, \"\");\n  }\n\n  private stripComments(code: string): string {\n    const withoutBlockComments = code.replace(/\\/\\*[\\s\\S]*?\\*\\//g, (match) => match.replace(/[^\\n\\r]/g, \"\"));\n    return withoutBlockComments.replace(/\\/\\/[^\\n\\r]*/g, \"\");\n  }\n}\n","export const indexConfig = {\n  blockMinLines: 5,\n  thresholds: {\n    class: 0.88,\n    function: 0.88,\n    block: 0.88,\n  },\n  weights: {\n    class: { self: 1 },\n    function: { self: 0.8, parentClass: 0.2 },\n    block: { self: 0.7, parentFunction: 0.2, parentClass: 0.1 },\n  },\n};\n","import upath from \"upath\";\nimport { DryConfig } from \"../types\";\nimport { ensureDefaultConfig, resolveDryConfig, saveDryConfig } from \"./dryconfig\";\n\nclass ConfigStore {\n  private readonly cache = new Map<string, DryConfig>();\n  private readonly loading = new Map<string, Promise<DryConfig>>();\n\n  async init(repoPath: string): Promise<DryConfig> {\n    const key = this.normalize(repoPath);\n    return this.load(key, repoPath);\n  }\n\n  async get(repoPath: string): Promise<DryConfig> {\n    const key = this.normalize(repoPath);\n    const cached = this.cache.get(key);\n    if (cached) return cached;\n    return this.load(key, repoPath);\n  }\n\n  async refresh(repoPath: string): Promise<DryConfig> {\n    const key = this.normalize(repoPath);\n    this.cache.delete(key);\n    return this.load(key, repoPath);\n  }\n\n  async save(repoPath: string, config: DryConfig): Promise<void> {\n    const key = this.normalize(repoPath);\n    await saveDryConfig(repoPath, config);\n    this.cache.set(key, config);\n  }\n\n  private async load(key: string, repoPath: string): Promise<DryConfig> {\n    const existing = this.loading.get(key);\n    if (existing) return existing;\n\n    const promise = ensureDefaultConfig(repoPath).then(() => resolveDryConfig(repoPath)).then((config) => {\n      this.cache.set(key, config);\n      this.loading.delete(key);\n      return config;\n    }).catch((err) => {\n      this.loading.delete(key);\n      throw err;\n    });\n\n    this.loading.set(key, promise);\n    return promise;\n  }\n\n  private normalize(repoPath: string): string {\n    return upath.normalizeTrim(upath.resolve(repoPath));\n  }\n}\n\nexport const configStore = new ConfigStore();\n","import fs from \"fs/promises\";\nimport upath from \"upath\";\nimport { Validator, Schema } from \"jsonschema\";\nimport { DryConfig } from \"../types\";\n\n// Baseline config used when no file is present; exported so tests and constructors can seed defaults.\nexport const DEFAULT_CONFIG: DryConfig = {\n  excludedPaths: [\n    \"**/test/**\",\n  ],\n  excludedPairs: [],\n  minLines: 3,\n  minBlockLines: 5,\n  threshold: 0.88,\n  embeddingSource: \"huggingface\",\n  contextLength: 2048,\n};\n\nconst validator = new Validator();\n\nconst partialConfigSchema: Schema = {\n  type: \"object\",\n  properties: {\n    excludedPaths: { type: \"array\", items: { type: \"string\" } },\n    excludedPairs: { type: \"array\", items: { type: \"string\" } },\n    minLines: { type: \"number\" },\n    minBlockLines: { type: \"number\" },\n    threshold: { type: \"number\" },\n    embeddingSource: { type: \"string\" },\n    contextLength: { type: \"number\" },\n  },\n};\n\nconst fullConfigSchema: Schema = {\n  ...partialConfigSchema,\n  required: [\n    \"excludedPaths\",\n    \"excludedPairs\",\n    \"minLines\",\n    \"minBlockLines\",\n    \"threshold\",\n    \"embeddingSource\",\n    \"contextLength\",\n  ],\n};\n\nfunction validateConfig(raw: unknown, schema: Schema, source: string): any {\n  const result = validator.validate(raw, schema);\n  if (!result.valid) {\n    const details = result.errors.map((e) => e.stack).join(\"; \");\n    throw new Error(`${source} config is invalid: ${details}`);\n  }\n  return raw;\n}\n\nasync function readConfigFile(repoPath: string): Promise<Partial<DryConfig>> {\n  const configPath = upath.join(repoPath, \"dryconfig.json\");\n  try {\n    const content = await fs.readFile(configPath, \"utf8\");\n    let parsed: Partial<DryConfig> = {};\n    try {\n      parsed = JSON.parse(content) as Partial<DryConfig>;\n    } catch (parseErr) {\n      throw new Error(`Invalid JSON in ${configPath}: ${(parseErr as Error).message}`);\n    }\n    return parsed;\n  } catch (err: any) {\n    if (err?.code === \"ENOENT\") {\n      return {};\n    }\n    throw err;\n  }\n}\n\n/**\n * Resolves the effective config for a repo using defaults merged with any file config.\n */\nexport async function resolveDryConfig(repoPath: string): Promise<DryConfig> {\n  const fileConfigRaw = await readConfigFile(repoPath);\n  validateConfig(fileConfigRaw, partialConfigSchema, \"Config file\");\n\n  const merged = { ...DEFAULT_CONFIG, ...fileConfigRaw };\n  validateConfig(merged, fullConfigSchema, \"Merged\");\n  return merged as DryConfig;\n}\n\n// Backwards-compatible helper used by existing callers (file + defaults).\nexport async function loadDryConfig(repoPath: string): Promise<DryConfig> {\n  return resolveDryConfig(repoPath);\n}\n\nexport async function saveDryConfig(repoPath: string, config: DryConfig): Promise<void> {\n  const configPath = upath.join(repoPath, \"dryconfig.json\");\n  validateConfig(config, fullConfigSchema, \"Config to save\");\n  await fs.writeFile(configPath, JSON.stringify(config, null, 2), \"utf8\");\n}\n\nexport async function ensureDefaultConfig(repoPath: string): Promise<void> {\n  const configPath = upath.join(repoPath, \"dryconfig.json\");\n  const repoExists = await fs.stat(repoPath).then((s) => s.isDirectory()).catch((err: any) => {\n    if (err?.code === \"ENOENT\") return false;\n    throw err;\n  });\n\n  if (!repoExists) return;\n\n  const exists = await fs.stat(configPath).then(() => true).catch((err: any) => {\n    if (err?.code === \"ENOENT\") return false;\n    throw err;\n  });\n\n  if (!exists) {\n    await saveDryConfig(repoPath, DEFAULT_CONFIG);\n  }\n}\n","import path from \"path\";\nimport fs from \"fs/promises\";\nimport upath from \"upath\";\nimport { glob } from \"glob-gitignore\";\nimport ignore, { Ignore } from \"ignore\";\nimport { DryConfig } from \"./types\";\n\n/**\n * Gitignore helper that builds ignore matchers by combining default rules,\n * repo .gitignore files, and config-driven exclusions.\n */\nexport class Gitignore {\n  private readonly defaultIgnores = [\".git/**\", \".dry/**\"];\n\n  constructor(private readonly root: string) {}\n\n  async buildMatcher(config: DryConfig): Promise<Ignore> {\n    const rules = await this.resolveRules(config);\n    return ignore({ allowRelativePaths: true }).add(rules);\n  }\n\n  private async resolveRules(config: DryConfig): Promise<string[]> {\n    const gitignoreRules = await this.loadGitignoreRules();\n    const configRules = config.excludedPaths || [];\n    return [...this.defaultIgnores, ...gitignoreRules, ...configRules];\n  }\n\n  private async loadGitignoreRules(): Promise<string[]> {\n    const gitignoreFiles = await glob(\"**/.gitignore\", {\n      cwd: this.root,\n      dot: true,\n      nodir: true,\n      ignore: this.defaultIgnores,\n    });\n\n    const rules: string[] = [];\n\n    for (const file of gitignoreFiles) {\n      const absPath = path.join(this.root, file);\n      const dir = upath.normalizeTrim(upath.dirname(file));\n      const content = await fs.readFile(absPath, \"utf8\").catch(() => \"\");\n      const lines = content.split(/\\r?\\n/);\n\n      for (const raw of lines) {\n        const trimmed = raw.trim();\n        if (!trimmed || trimmed.startsWith(\"#\")) continue;\n\n        const negated = trimmed.startsWith(\"!\");\n        const body = negated ? trimmed.slice(1) : trimmed;\n\n        const scoped = this.scopeRule(body, dir);\n        if (!scoped) continue;\n\n        rules.push(negated ? `!${scoped}` : scoped);\n      }\n    }\n\n    return rules;\n  }\n\n  private scopeRule(rule: string, gitignoreDir: string): string | null {\n    const cleaned = rule.replace(/^\\//, \"\");\n    if (!cleaned) return null;\n\n    if (!gitignoreDir || gitignoreDir === \".\") {\n      return cleaned;\n    }\n\n    return upath.normalizeTrim(upath.join(gitignoreDir, cleaned));\n  }\n}\n","import \"reflect-metadata\";\nimport fs from \"fs/promises\";\nimport upath from \"upath\";\nimport { DataSource, Repository, In } from \"typeorm\";\nimport { FileEntity } from \"./entities/FileEntity\";\nimport { IndexUnit } from \"../types\";\nimport { IndexUnitEntity } from \"./entities/IndexUnitEntity\";\n\nexport class DryScanDatabase {\n  private dataSource?: DataSource;\n  private unitRepository?: Repository<IndexUnitEntity>;\n  private fileRepository?: Repository<FileEntity>;\n\n  isInitialized(): boolean {\n    return !!this.dataSource?.isInitialized;\n  }\n\n  async init(dbPath: string): Promise<void> {\n    await fs.mkdir(upath.dirname(dbPath), { recursive: true });\n\n    this.dataSource = new DataSource({\n      type: \"sqlite\",\n      database: dbPath,\n      entities: [IndexUnitEntity, FileEntity],\n      synchronize: true,\n      logging: false,\n    });\n\n    await this.dataSource.initialize();\n    this.unitRepository = this.dataSource.getRepository(IndexUnitEntity);\n    this.fileRepository = this.dataSource.getRepository(FileEntity);\n  }\n\n  async saveUnit(unit: IndexUnit): Promise<void> {\n    await this.saveUnits(unit);\n  }\n\n  async saveUnits(units: IndexUnit | IndexUnit[]): Promise<void> {\n    if (!this.unitRepository) throw new Error(\"Database not initialized\");\n    const payload = Array.isArray(units) ? units : [units];\n    await this.unitRepository.save(payload);\n  }\n\n  async getUnit(id: string): Promise<IndexUnit | null> {\n    if (!this.unitRepository) throw new Error(\"Database not initialized\");\n    return this.unitRepository.findOne({ \n      where: { id },\n      relations: [\"children\", \"parent\"]\n    });\n  }\n\n  async getAllUnits(): Promise<IndexUnit[]> {\n    if (!this.unitRepository) throw new Error(\"Database not initialized\");\n    return this.unitRepository.find({ relations: [\"children\", \"parent\"] });\n  }\n\n  async updateUnit(unit: IndexUnit): Promise<void> {\n    await this.saveUnits(unit);\n  }\n\n  async updateUnits(units: IndexUnit | IndexUnit[]): Promise<void> {\n    await this.saveUnits(units);\n  }\n\n  /**\n   * Returns total count of indexed units.\n   */\n  async countUnits(): Promise<number> {\n    if (!this.unitRepository) throw new Error(\"Database not initialized\");\n    return this.unitRepository.count();\n  }\n\n  /**\n   * Removes index units by their file paths.\n   * Used during incremental updates when files change.\n   */\n  async removeUnitsByFilePaths(filePaths: string[]): Promise<void> {\n    if (!this.unitRepository) throw new Error(\"Database not initialized\");\n    await this.unitRepository.delete({ filePath: In(filePaths) });\n  }\n\n  /**\n   * Saves file metadata (path, checksum, mtime) to track changes.\n   */\n  async saveFile(file: FileEntity): Promise<void> {\n    if (!this.fileRepository) throw new Error(\"Database not initialized\");\n    await this.fileRepository.save(file);\n  }\n\n  /**\n   * Saves multiple file metadata entries.\n   */\n  async saveFiles(files: FileEntity[]): Promise<void> {\n    if (!this.fileRepository) throw new Error(\"Database not initialized\");\n    await this.fileRepository.save(files);\n  }\n\n  /**\n   * Gets file metadata by file path.\n   */\n  async getFile(filePath: string): Promise<FileEntity | null> {\n    if (!this.fileRepository) throw new Error(\"Database not initialized\");\n    return this.fileRepository.findOne({ where: { filePath } });\n  }\n\n  /**\n   * Gets all tracked files.\n   */\n  async getAllFiles(): Promise<FileEntity[]> {\n    if (!this.fileRepository) throw new Error(\"Database not initialized\");\n    return this.fileRepository.find();\n  }\n\n  /**\n   * Removes file metadata entries by file paths.\n   * Used when files are deleted from repository.\n   */\n  async removeFilesByFilePaths(filePaths: string[]): Promise<void> {\n    if (!this.fileRepository) throw new Error(\"Database not initialized\");\n    await this.fileRepository.delete({ filePath: In(filePaths) });\n  }\n\n  async close(): Promise<void> {\n    if (this.dataSource?.isInitialized) {\n      await this.dataSource.destroy();\n    }\n  }\n}\n","import { Entity, PrimaryColumn, Column } from \"typeorm\";\n\n/**\n * Represents a tracked source file in the repository.\n * Used to detect changes via checksum and mtime for incremental updates.\n */\n@Entity(\"files\")\nexport class FileEntity {\n  /**\n   * Relative path to the file from repository root.\n   * Used as primary key for uniqueness.\n   */\n  @PrimaryColumn(\"text\")\n  filePath!: string;\n\n  /**\n   * MD5 checksum of file content.\n   * Used to detect content changes.\n   */\n  @Column(\"text\")\n  checksum!: string;\n\n  /**\n   * Last modification time in milliseconds since epoch.\n   * Used as fast sanity check before computing checksum.\n   */\n  @Column(\"integer\")\n  mtime!: number;\n}\n","import {\n  Column,\n  Entity,\n  JoinColumn,\n  ManyToOne,\n  OneToMany,\n  PrimaryColumn,\n  RelationId,\n} from \"typeorm\";\nimport { IndexUnit, IndexUnitType } from \"../../types\";\n\n@Entity(\"index_units\")\nexport class IndexUnitEntity implements IndexUnit {\n  @PrimaryColumn(\"text\")\n  id!: string;\n\n  @Column(\"text\")\n  name!: string;\n\n  @Column(\"text\")\n  filePath!: string;\n\n  @Column(\"integer\")\n  startLine!: number;\n\n  @Column(\"integer\")\n  endLine!: number;\n\n  @Column(\"text\")\n  code!: string;\n\n  @Column(\"text\")\n  unitType!: IndexUnitType;\n\n  @ManyToOne(() => IndexUnitEntity, (unit) => unit.children, {\n    nullable: true,\n    onDelete: \"CASCADE\",\n  })\n  @JoinColumn({ name: \"parent_id\" })\n  parent?: IndexUnitEntity | null;\n\n  @RelationId((unit: IndexUnitEntity) => unit.parent)\n  parentId?: string | null;\n\n  @OneToMany(() => IndexUnitEntity, (unit) => unit.parent, { nullable: true })\n  children?: IndexUnitEntity[];\n\n  @Column(\"simple-array\", { nullable: true })\n  embedding?: number[] | null;\n}\n","import path from \"path\";\nimport fs from \"fs/promises\";\nimport { DryScanServiceDeps } from \"./types\";\nimport { ExclusionService } from \"./ExclusionService\";\nimport { IndexUnit } from \"../types\";\nimport { EmbeddingService } from \"./EmbeddingService\";\nimport { FileEntity } from \"../db/entities/FileEntity\";\nimport { IndexUnitExtractor } from \"../IndexUnitExtractor\";\n\nexport interface InitOptions {\n  skipEmbeddings?: boolean;\n}\n\nexport class RepositoryInitializer {\n  constructor(\n    private readonly deps: DryScanServiceDeps,\n    private readonly exclusionService: ExclusionService\n  ) {}\n\n  async init(options?: InitOptions): Promise<void> {\n    const extractor = this.deps.extractor;\n\n    console.log(\"[DryScan] Phase 1/3: Extracting code units...\");\n    await this.initUnits(extractor);\n    console.log(\"[DryScan] Phase 2/3: Computing embeddings (may be slow)...\");\n    await this.computeEmbeddings(options?.skipEmbeddings === true);\n    console.log(\"[DryScan] Phase 3/3: Tracking files...\");\n    await this.trackFiles(extractor);\n    await this.exclusionService.cleanupExcludedFiles();\n    console.log(\"[DryScan] Initialization phases complete.\");\n  }\n\n  private async initUnits(extractor: IndexUnitExtractor): Promise<void> {\n    const units = await extractor.scan(this.deps.repoPath);\n    console.log(`[DryScan] Extracted ${units.length} index units.`);\n    await this.deps.db.saveUnits(units);\n  }\n\n  private async computeEmbeddings(skipEmbeddings: boolean): Promise<void> {\n    if (skipEmbeddings) {\n      console.log(\"[DryScan] Skipping embedding computation by request.\");\n      return;\n    }\n    const allUnits: IndexUnit[] = await this.deps.db.getAllUnits();\n    const total = allUnits.length;\n    console.log(`[DryScan] Computing embeddings for ${total} units...`);\n\n    const updated: IndexUnit[] = [];\n    const progressInterval = Math.max(1, Math.ceil(total / 10));\n    const embeddingService = new EmbeddingService(this.deps.repoPath);\n\n    for (let i = 0; i < total; i++) {\n      const unit = allUnits[i];\n      try {\n        const enriched = await embeddingService.addEmbedding(unit);\n        updated.push(enriched);\n      } catch (err: any) {\n        console.error(\n          `[DryScan] Embedding failed for ${unit.filePath} (${unit.name}): ${err?.message || err}`\n        );\n        throw err;\n      }\n\n      const completed = i + 1;\n      if (completed === total || completed % progressInterval === 0) {\n        const pct = Math.floor((completed / total) * 100);\n        console.log(`[DryScan] Embeddings ${completed}/${total} (${pct}%)`);\n      }\n    }\n\n    await this.deps.db.updateUnits(updated);\n  }\n\n  private async trackFiles(extractor: IndexUnitExtractor): Promise<void> {\n    const allFunctions = await extractor.listSourceFiles(this.deps.repoPath);\n    const fileEntities: FileEntity[] = [];\n\n    for (const relPath of allFunctions) {\n      const fullPath = path.join(this.deps.repoPath, relPath);\n      const stat = await fs.stat(fullPath);\n      const checksum = await extractor.computeChecksum(fullPath);\n\n      const fileEntity = new FileEntity();\n      fileEntity.filePath = relPath;\n      fileEntity.checksum = checksum;\n      fileEntity.mtime = stat.mtimeMs;\n      fileEntities.push(fileEntity);\n    }\n\n    await this.deps.db.saveFiles(fileEntities);\n    console.log(`[DryScan] Tracked ${fileEntities.length} files.`);\n  }\n}","import debug from \"debug\";\nimport { OllamaEmbeddings } from \"@langchain/ollama\";\nimport { HuggingFaceInferenceEmbeddings } from \"@langchain/community/embeddings/hf\";\nimport { IndexUnit } from \"../types\";\nimport { configStore } from \"../config/configStore\";\n\nconst log = debug(\"DryScan:EmbeddingService\");\n\n// Model names for each provider\nconst OLLAMA_MODEL = \"embeddinggemma\";\nconst HUGGINGFACE_MODEL = \"google/embeddinggemma-300m\";\n\nexport class EmbeddingService {\n    constructor(private readonly repoPath: string) { }\n\n    /**\n     * Generates an embedding for the given index unit using the configured provider.\n     * Skips embedding if code exceeds the configured context length.\n     */\n    async addEmbedding(fn: IndexUnit): Promise<IndexUnit> {\n        const config = await configStore.get(this.repoPath);\n        const maxContext = config?.contextLength ?? 2048;\n        if (fn.code.length > maxContext) {\n            log(\n                \"Skipping embedding for %s (code length %d exceeds context %d)\",\n                fn.id,\n                fn.code.length,\n                maxContext\n            );\n            return { ...fn, embedding: null };\n        }\n\n        const source = config.embeddingSource;\n        if (!source) {\n            const message = `Embedding source is not configured for repository at ${this.repoPath}`;\n            log(message);\n            throw new Error(message);\n        }\n\n        const embeddings = this.buildProvider(source);\n        const embedding = await embeddings.embedQuery(fn.code);\n        return { ...fn, embedding };\n    }\n\n    /**\n     * Builds the embedding provider based on the source configuration.\n     * - URL (http/https): Uses Ollama with \"embeddinggemma\" model\n     * - \"huggingface\": Uses HuggingFace Inference API with \"embeddinggemma-300m\" model\n     */\n    private buildProvider(source: string) {\n        // HuggingFace Inference API\n        if (source.toLowerCase() === \"huggingface\") {\n            log(\"Using HuggingFace Inference with model: %s\", HUGGINGFACE_MODEL);\n            return new HuggingFaceInferenceEmbeddings({\n                model: HUGGINGFACE_MODEL,\n            });\n        }\n\n        // Ollama (local or remote URL)\n        if (/^https?:\\/\\//i.test(source)) {\n            log(\"Using Ollama at %s with model: %s\", source, OLLAMA_MODEL);\n            return new OllamaEmbeddings({\n                model: OLLAMA_MODEL,\n                baseUrl: source,\n            });\n        }\n\n        const message = `Unsupported embedding source: ${source || \"(empty)\"}. Use \"huggingface\" or an Ollama URL.`;\n        log(message);\n        throw new Error(message);\n    }\n}","/* eslint-disable no-prototype-builtins */\nvar g =\n  (typeof globalThis !== 'undefined' && globalThis) ||\n  (typeof self !== 'undefined' && self) ||\n  // eslint-disable-next-line no-undef\n  (typeof global !== 'undefined' && global) ||\n  {}\n\nvar support = {\n  searchParams: 'URLSearchParams' in g,\n  iterable: 'Symbol' in g && 'iterator' in Symbol,\n  blob:\n    'FileReader' in g &&\n    'Blob' in g &&\n    (function() {\n      try {\n        new Blob()\n        return true\n      } catch (e) {\n        return false\n      }\n    })(),\n  formData: 'FormData' in g,\n  arrayBuffer: 'ArrayBuffer' in g\n}\n\nfunction isDataView(obj) {\n  return obj && DataView.prototype.isPrototypeOf(obj)\n}\n\nif (support.arrayBuffer) {\n  var viewClasses = [\n    '[object Int8Array]',\n    '[object Uint8Array]',\n    '[object Uint8ClampedArray]',\n    '[object Int16Array]',\n    '[object Uint16Array]',\n    '[object Int32Array]',\n    '[object Uint32Array]',\n    '[object Float32Array]',\n    '[object Float64Array]'\n  ]\n\n  var isArrayBufferView =\n    ArrayBuffer.isView ||\n    function(obj) {\n      return obj && viewClasses.indexOf(Object.prototype.toString.call(obj)) > -1\n    }\n}\n\nfunction normalizeName(name) {\n  if (typeof name !== 'string') {\n    name = String(name)\n  }\n  if (/[^a-z0-9\\-#$%&'*+.^_`|~!]/i.test(name) || name === '') {\n    throw new TypeError('Invalid character in header field name: \"' + name + '\"')\n  }\n  return name.toLowerCase()\n}\n\nfunction normalizeValue(value) {\n  if (typeof value !== 'string') {\n    value = String(value)\n  }\n  return value\n}\n\n// Build a destructive iterator for the value list\nfunction iteratorFor(items) {\n  var iterator = {\n    next: function() {\n      var value = items.shift()\n      return {done: value === undefined, value: value}\n    }\n  }\n\n  if (support.iterable) {\n    iterator[Symbol.iterator] = function() {\n      return iterator\n    }\n  }\n\n  return iterator\n}\n\nexport function Headers(headers) {\n  this.map = {}\n\n  if (headers instanceof Headers) {\n    headers.forEach(function(value, name) {\n      this.append(name, value)\n    }, this)\n  } else if (Array.isArray(headers)) {\n    headers.forEach(function(header) {\n      if (header.length != 2) {\n        throw new TypeError('Headers constructor: expected name/value pair to be length 2, found' + header.length)\n      }\n      this.append(header[0], header[1])\n    }, this)\n  } else if (headers) {\n    Object.getOwnPropertyNames(headers).forEach(function(name) {\n      this.append(name, headers[name])\n    }, this)\n  }\n}\n\nHeaders.prototype.append = function(name, value) {\n  name = normalizeName(name)\n  value = normalizeValue(value)\n  var oldValue = this.map[name]\n  this.map[name] = oldValue ? oldValue + ', ' + value : value\n}\n\nHeaders.prototype['delete'] = function(name) {\n  delete this.map[normalizeName(name)]\n}\n\nHeaders.prototype.get = function(name) {\n  name = normalizeName(name)\n  return this.has(name) ? this.map[name] : null\n}\n\nHeaders.prototype.has = function(name) {\n  return this.map.hasOwnProperty(normalizeName(name))\n}\n\nHeaders.prototype.set = function(name, value) {\n  this.map[normalizeName(name)] = normalizeValue(value)\n}\n\nHeaders.prototype.forEach = function(callback, thisArg) {\n  for (var name in this.map) {\n    if (this.map.hasOwnProperty(name)) {\n      callback.call(thisArg, this.map[name], name, this)\n    }\n  }\n}\n\nHeaders.prototype.keys = function() {\n  var items = []\n  this.forEach(function(value, name) {\n    items.push(name)\n  })\n  return iteratorFor(items)\n}\n\nHeaders.prototype.values = function() {\n  var items = []\n  this.forEach(function(value) {\n    items.push(value)\n  })\n  return iteratorFor(items)\n}\n\nHeaders.prototype.entries = function() {\n  var items = []\n  this.forEach(function(value, name) {\n    items.push([name, value])\n  })\n  return iteratorFor(items)\n}\n\nif (support.iterable) {\n  Headers.prototype[Symbol.iterator] = Headers.prototype.entries\n}\n\nfunction consumed(body) {\n  if (body._noBody) return\n  if (body.bodyUsed) {\n    return Promise.reject(new TypeError('Already read'))\n  }\n  body.bodyUsed = true\n}\n\nfunction fileReaderReady(reader) {\n  return new Promise(function(resolve, reject) {\n    reader.onload = function() {\n      resolve(reader.result)\n    }\n    reader.onerror = function() {\n      reject(reader.error)\n    }\n  })\n}\n\nfunction readBlobAsArrayBuffer(blob) {\n  var reader = new FileReader()\n  var promise = fileReaderReady(reader)\n  reader.readAsArrayBuffer(blob)\n  return promise\n}\n\nfunction readBlobAsText(blob) {\n  var reader = new FileReader()\n  var promise = fileReaderReady(reader)\n  var match = /charset=([A-Za-z0-9_-]+)/.exec(blob.type)\n  var encoding = match ? match[1] : 'utf-8'\n  reader.readAsText(blob, encoding)\n  return promise\n}\n\nfunction readArrayBufferAsText(buf) {\n  var view = new Uint8Array(buf)\n  var chars = new Array(view.length)\n\n  for (var i = 0; i < view.length; i++) {\n    chars[i] = String.fromCharCode(view[i])\n  }\n  return chars.join('')\n}\n\nfunction bufferClone(buf) {\n  if (buf.slice) {\n    return buf.slice(0)\n  } else {\n    var view = new Uint8Array(buf.byteLength)\n    view.set(new Uint8Array(buf))\n    return view.buffer\n  }\n}\n\nfunction Body() {\n  this.bodyUsed = false\n\n  this._initBody = function(body) {\n    /*\n      fetch-mock wraps the Response object in an ES6 Proxy to\n      provide useful test harness features such as flush. However, on\n      ES5 browsers without fetch or Proxy support pollyfills must be used;\n      the proxy-pollyfill is unable to proxy an attribute unless it exists\n      on the object before the Proxy is created. This change ensures\n      Response.bodyUsed exists on the instance, while maintaining the\n      semantic of setting Request.bodyUsed in the constructor before\n      _initBody is called.\n    */\n    // eslint-disable-next-line no-self-assign\n    this.bodyUsed = this.bodyUsed\n    this._bodyInit = body\n    if (!body) {\n      this._noBody = true;\n      this._bodyText = ''\n    } else if (typeof body === 'string') {\n      this._bodyText = body\n    } else if (support.blob && Blob.prototype.isPrototypeOf(body)) {\n      this._bodyBlob = body\n    } else if (support.formData && FormData.prototype.isPrototypeOf(body)) {\n      this._bodyFormData = body\n    } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n      this._bodyText = body.toString()\n    } else if (support.arrayBuffer && support.blob && isDataView(body)) {\n      this._bodyArrayBuffer = bufferClone(body.buffer)\n      // IE 10-11 can't handle a DataView body.\n      this._bodyInit = new Blob([this._bodyArrayBuffer])\n    } else if (support.arrayBuffer && (ArrayBuffer.prototype.isPrototypeOf(body) || isArrayBufferView(body))) {\n      this._bodyArrayBuffer = bufferClone(body)\n    } else {\n      this._bodyText = body = Object.prototype.toString.call(body)\n    }\n\n    if (!this.headers.get('content-type')) {\n      if (typeof body === 'string') {\n        this.headers.set('content-type', 'text/plain;charset=UTF-8')\n      } else if (this._bodyBlob && this._bodyBlob.type) {\n        this.headers.set('content-type', this._bodyBlob.type)\n      } else if (support.searchParams && URLSearchParams.prototype.isPrototypeOf(body)) {\n        this.headers.set('content-type', 'application/x-www-form-urlencoded;charset=UTF-8')\n      }\n    }\n  }\n\n  if (support.blob) {\n    this.blob = function() {\n      var rejected = consumed(this)\n      if (rejected) {\n        return rejected\n      }\n\n      if (this._bodyBlob) {\n        return Promise.resolve(this._bodyBlob)\n      } else if (this._bodyArrayBuffer) {\n        return Promise.resolve(new Blob([this._bodyArrayBuffer]))\n      } else if (this._bodyFormData) {\n        throw new Error('could not read FormData body as blob')\n      } else {\n        return Promise.resolve(new Blob([this._bodyText]))\n      }\n    }\n  }\n\n  this.arrayBuffer = function() {\n    if (this._bodyArrayBuffer) {\n      var isConsumed = consumed(this)\n      if (isConsumed) {\n        return isConsumed\n      } else if (ArrayBuffer.isView(this._bodyArrayBuffer)) {\n        return Promise.resolve(\n          this._bodyArrayBuffer.buffer.slice(\n            this._bodyArrayBuffer.byteOffset,\n            this._bodyArrayBuffer.byteOffset + this._bodyArrayBuffer.byteLength\n          )\n        )\n      } else {\n        return Promise.resolve(this._bodyArrayBuffer)\n      }\n    } else if (support.blob) {\n      return this.blob().then(readBlobAsArrayBuffer)\n    } else {\n      throw new Error('could not read as ArrayBuffer')\n    }\n  }\n\n  this.text = function() {\n    var rejected = consumed(this)\n    if (rejected) {\n      return rejected\n    }\n\n    if (this._bodyBlob) {\n      return readBlobAsText(this._bodyBlob)\n    } else if (this._bodyArrayBuffer) {\n      return Promise.resolve(readArrayBufferAsText(this._bodyArrayBuffer))\n    } else if (this._bodyFormData) {\n      throw new Error('could not read FormData body as text')\n    } else {\n      return Promise.resolve(this._bodyText)\n    }\n  }\n\n  if (support.formData) {\n    this.formData = function() {\n      return this.text().then(decode)\n    }\n  }\n\n  this.json = function() {\n    return this.text().then(JSON.parse)\n  }\n\n  return this\n}\n\n// HTTP methods whose capitalization should be normalized\nvar methods = ['CONNECT', 'DELETE', 'GET', 'HEAD', 'OPTIONS', 'PATCH', 'POST', 'PUT', 'TRACE']\n\nfunction normalizeMethod(method) {\n  var upcased = method.toUpperCase()\n  return methods.indexOf(upcased) > -1 ? upcased : method\n}\n\nexport function Request(input, options) {\n  if (!(this instanceof Request)) {\n    throw new TypeError('Please use the \"new\" operator, this DOM object constructor cannot be called as a function.')\n  }\n\n  options = options || {}\n  var body = options.body\n\n  if (input instanceof Request) {\n    if (input.bodyUsed) {\n      throw new TypeError('Already read')\n    }\n    this.url = input.url\n    this.credentials = input.credentials\n    if (!options.headers) {\n      this.headers = new Headers(input.headers)\n    }\n    this.method = input.method\n    this.mode = input.mode\n    this.signal = input.signal\n    if (!body && input._bodyInit != null) {\n      body = input._bodyInit\n      input.bodyUsed = true\n    }\n  } else {\n    this.url = String(input)\n  }\n\n  this.credentials = options.credentials || this.credentials || 'same-origin'\n  if (options.headers || !this.headers) {\n    this.headers = new Headers(options.headers)\n  }\n  this.method = normalizeMethod(options.method || this.method || 'GET')\n  this.mode = options.mode || this.mode || null\n  this.signal = options.signal || this.signal || (function () {\n    if ('AbortController' in g) {\n      var ctrl = new AbortController();\n      return ctrl.signal;\n    }\n  }());\n  this.referrer = null\n\n  if ((this.method === 'GET' || this.method === 'HEAD') && body) {\n    throw new TypeError('Body not allowed for GET or HEAD requests')\n  }\n  this._initBody(body)\n\n  if (this.method === 'GET' || this.method === 'HEAD') {\n    if (options.cache === 'no-store' || options.cache === 'no-cache') {\n      // Search for a '_' parameter in the query string\n      var reParamSearch = /([?&])_=[^&]*/\n      if (reParamSearch.test(this.url)) {\n        // If it already exists then set the value with the current time\n        this.url = this.url.replace(reParamSearch, '$1_=' + new Date().getTime())\n      } else {\n        // Otherwise add a new '_' parameter to the end with the current time\n        var reQueryString = /\\?/\n        this.url += (reQueryString.test(this.url) ? '&' : '?') + '_=' + new Date().getTime()\n      }\n    }\n  }\n}\n\nRequest.prototype.clone = function() {\n  return new Request(this, {body: this._bodyInit})\n}\n\nfunction decode(body) {\n  var form = new FormData()\n  body\n    .trim()\n    .split('&')\n    .forEach(function(bytes) {\n      if (bytes) {\n        var split = bytes.split('=')\n        var name = split.shift().replace(/\\+/g, ' ')\n        var value = split.join('=').replace(/\\+/g, ' ')\n        form.append(decodeURIComponent(name), decodeURIComponent(value))\n      }\n    })\n  return form\n}\n\nfunction parseHeaders(rawHeaders) {\n  var headers = new Headers()\n  // Replace instances of \\r\\n and \\n followed by at least one space or horizontal tab with a space\n  // https://tools.ietf.org/html/rfc7230#section-3.2\n  var preProcessedHeaders = rawHeaders.replace(/\\r?\\n[\\t ]+/g, ' ')\n  // Avoiding split via regex to work around a common IE11 bug with the core-js 3.6.0 regex polyfill\n  // https://github.com/github/fetch/issues/748\n  // https://github.com/zloirock/core-js/issues/751\n  preProcessedHeaders\n    .split('\\r')\n    .map(function(header) {\n      return header.indexOf('\\n') === 0 ? header.substr(1, header.length) : header\n    })\n    .forEach(function(line) {\n      var parts = line.split(':')\n      var key = parts.shift().trim()\n      if (key) {\n        var value = parts.join(':').trim()\n        try {\n          headers.append(key, value)\n        } catch (error) {\n          console.warn('Response ' + error.message)\n        }\n      }\n    })\n  return headers\n}\n\nBody.call(Request.prototype)\n\nexport function Response(bodyInit, options) {\n  if (!(this instanceof Response)) {\n    throw new TypeError('Please use the \"new\" operator, this DOM object constructor cannot be called as a function.')\n  }\n  if (!options) {\n    options = {}\n  }\n\n  this.type = 'default'\n  this.status = options.status === undefined ? 200 : options.status\n  if (this.status < 200 || this.status > 599) {\n    throw new RangeError(\"Failed to construct 'Response': The status provided (0) is outside the range [200, 599].\")\n  }\n  this.ok = this.status >= 200 && this.status < 300\n  this.statusText = options.statusText === undefined ? '' : '' + options.statusText\n  this.headers = new Headers(options.headers)\n  this.url = options.url || ''\n  this._initBody(bodyInit)\n}\n\nBody.call(Response.prototype)\n\nResponse.prototype.clone = function() {\n  return new Response(this._bodyInit, {\n    status: this.status,\n    statusText: this.statusText,\n    headers: new Headers(this.headers),\n    url: this.url\n  })\n}\n\nResponse.error = function() {\n  var response = new Response(null, {status: 200, statusText: ''})\n  response.ok = false\n  response.status = 0\n  response.type = 'error'\n  return response\n}\n\nvar redirectStatuses = [301, 302, 303, 307, 308]\n\nResponse.redirect = function(url, status) {\n  if (redirectStatuses.indexOf(status) === -1) {\n    throw new RangeError('Invalid status code')\n  }\n\n  return new Response(null, {status: status, headers: {location: url}})\n}\n\nexport var DOMException = g.DOMException\ntry {\n  new DOMException()\n} catch (err) {\n  DOMException = function(message, name) {\n    this.message = message\n    this.name = name\n    var error = Error(message)\n    this.stack = error.stack\n  }\n  DOMException.prototype = Object.create(Error.prototype)\n  DOMException.prototype.constructor = DOMException\n}\n\nexport function fetch(input, init) {\n  return new Promise(function(resolve, reject) {\n    var request = new Request(input, init)\n\n    if (request.signal && request.signal.aborted) {\n      return reject(new DOMException('Aborted', 'AbortError'))\n    }\n\n    var xhr = new XMLHttpRequest()\n\n    function abortXhr() {\n      xhr.abort()\n    }\n\n    xhr.onload = function() {\n      var options = {\n        statusText: xhr.statusText,\n        headers: parseHeaders(xhr.getAllResponseHeaders() || '')\n      }\n      // This check if specifically for when a user fetches a file locally from the file system\n      // Only if the status is out of a normal range\n      if (request.url.indexOf('file://') === 0 && (xhr.status < 200 || xhr.status > 599)) {\n        options.status = 200;\n      } else {\n        options.status = xhr.status;\n      }\n      options.url = 'responseURL' in xhr ? xhr.responseURL : options.headers.get('X-Request-URL')\n      var body = 'response' in xhr ? xhr.response : xhr.responseText\n      setTimeout(function() {\n        resolve(new Response(body, options))\n      }, 0)\n    }\n\n    xhr.onerror = function() {\n      setTimeout(function() {\n        reject(new TypeError('Network request failed'))\n      }, 0)\n    }\n\n    xhr.ontimeout = function() {\n      setTimeout(function() {\n        reject(new TypeError('Network request timed out'))\n      }, 0)\n    }\n\n    xhr.onabort = function() {\n      setTimeout(function() {\n        reject(new DOMException('Aborted', 'AbortError'))\n      }, 0)\n    }\n\n    function fixUrl(url) {\n      try {\n        return url === '' && g.location.href ? g.location.href : url\n      } catch (e) {\n        return url\n      }\n    }\n\n    xhr.open(request.method, fixUrl(request.url), true)\n\n    if (request.credentials === 'include') {\n      xhr.withCredentials = true\n    } else if (request.credentials === 'omit') {\n      xhr.withCredentials = false\n    }\n\n    if ('responseType' in xhr) {\n      if (support.blob) {\n        xhr.responseType = 'blob'\n      } else if (\n        support.arrayBuffer\n      ) {\n        xhr.responseType = 'arraybuffer'\n      }\n    }\n\n    if (init && typeof init.headers === 'object' && !(init.headers instanceof Headers || (g.Headers && init.headers instanceof g.Headers))) {\n      var names = [];\n      Object.getOwnPropertyNames(init.headers).forEach(function(name) {\n        names.push(normalizeName(name))\n        xhr.setRequestHeader(name, normalizeValue(init.headers[name]))\n      })\n      request.headers.forEach(function(value, name) {\n        if (names.indexOf(name) === -1) {\n          xhr.setRequestHeader(name, value)\n        }\n      })\n    } else {\n      request.headers.forEach(function(value, name) {\n        xhr.setRequestHeader(name, value)\n      })\n    }\n\n    if (request.signal) {\n      request.signal.addEventListener('abort', abortXhr)\n\n      xhr.onreadystatechange = function() {\n        // DONE (success or failure)\n        if (xhr.readyState === 4) {\n          request.signal.removeEventListener('abort', abortXhr)\n        }\n      }\n    }\n\n    xhr.send(typeof request._bodyInit === 'undefined' ? null : request._bodyInit)\n  })\n}\n\nfetch.polyfill = true\n\nif (!g.fetch) {\n  g.fetch = fetch\n  g.Headers = Headers\n  g.Request = Request\n  g.Response = Response\n}\n","import 'whatwg-fetch';\n\nconst defaultPort = \"11434\";\nconst defaultHost = `http://127.0.0.1:${defaultPort}`;\n\nconst version = \"0.6.3\";\n\nvar __defProp$1 = Object.defineProperty;\nvar __defNormalProp$1 = (obj, key, value) => key in obj ? __defProp$1(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField$1 = (obj, key, value) => {\n  __defNormalProp$1(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nclass ResponseError extends Error {\n  constructor(error, status_code) {\n    super(error);\n    this.error = error;\n    this.status_code = status_code;\n    this.name = \"ResponseError\";\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, ResponseError);\n    }\n  }\n}\nclass AbortableAsyncIterator {\n  constructor(abortController, itr, doneCallback) {\n    __publicField$1(this, \"abortController\");\n    __publicField$1(this, \"itr\");\n    __publicField$1(this, \"doneCallback\");\n    this.abortController = abortController;\n    this.itr = itr;\n    this.doneCallback = doneCallback;\n  }\n  abort() {\n    this.abortController.abort();\n  }\n  async *[Symbol.asyncIterator]() {\n    for await (const message of this.itr) {\n      if (\"error\" in message) {\n        throw new Error(message.error);\n      }\n      yield message;\n      if (message.done || message.status === \"success\") {\n        this.doneCallback();\n        return;\n      }\n    }\n    throw new Error(\"Did not receive done or success response in stream.\");\n  }\n}\nconst checkOk = async (response) => {\n  if (response.ok) {\n    return;\n  }\n  let message = `Error ${response.status}: ${response.statusText}`;\n  let errorData = null;\n  if (response.headers.get(\"content-type\")?.includes(\"application/json\")) {\n    try {\n      errorData = await response.json();\n      message = errorData.error || message;\n    } catch (error) {\n      console.log(\"Failed to parse error response as JSON\");\n    }\n  } else {\n    try {\n      console.log(\"Getting text from response\");\n      const textResponse = await response.text();\n      message = textResponse || message;\n    } catch (error) {\n      console.log(\"Failed to get text from error response\");\n    }\n  }\n  throw new ResponseError(message, response.status);\n};\nfunction getPlatform() {\n  if (typeof window !== \"undefined\" && window.navigator) {\n    const nav = navigator;\n    if (\"userAgentData\" in nav && nav.userAgentData?.platform) {\n      return `${nav.userAgentData.platform.toLowerCase()} Browser/${navigator.userAgent};`;\n    }\n    if (navigator.platform) {\n      return `${navigator.platform.toLowerCase()} Browser/${navigator.userAgent};`;\n    }\n    return `unknown Browser/${navigator.userAgent};`;\n  } else if (typeof process !== \"undefined\") {\n    return `${process.arch} ${process.platform} Node.js/${process.version}`;\n  }\n  return \"\";\n}\nfunction normalizeHeaders(headers) {\n  if (headers instanceof Headers) {\n    const obj = {};\n    headers.forEach((value, key) => {\n      obj[key] = value;\n    });\n    return obj;\n  } else if (Array.isArray(headers)) {\n    return Object.fromEntries(headers);\n  } else {\n    return headers || {};\n  }\n}\nconst readEnvVar = (obj, key) => {\n  return obj[key];\n};\nconst fetchWithHeaders = async (fetch, url, options = {}) => {\n  const defaultHeaders = {\n    \"Content-Type\": \"application/json\",\n    Accept: \"application/json\",\n    \"User-Agent\": `ollama-js/${version} (${getPlatform()})`\n  };\n  options.headers = normalizeHeaders(options.headers);\n  try {\n    const parsed = new URL(url);\n    if (parsed.protocol === \"https:\" && parsed.hostname === \"ollama.com\") {\n      const apiKey = typeof process === \"object\" && process !== null && typeof process.env === \"object\" && process.env !== null ? readEnvVar(process.env, \"OLLAMA_API_KEY\") : void 0;\n      const authorization = options.headers[\"authorization\"] || options.headers[\"Authorization\"];\n      if (!authorization && apiKey) {\n        options.headers[\"Authorization\"] = `Bearer ${apiKey}`;\n      }\n    }\n  } catch (error) {\n    console.error(\"error parsing url\", error);\n  }\n  const customHeaders = Object.fromEntries(\n    Object.entries(options.headers).filter(\n      ([key]) => !Object.keys(defaultHeaders).some(\n        (defaultKey) => defaultKey.toLowerCase() === key.toLowerCase()\n      )\n    )\n  );\n  options.headers = {\n    ...defaultHeaders,\n    ...customHeaders\n  };\n  return fetch(url, options);\n};\nconst get = async (fetch, host, options) => {\n  const response = await fetchWithHeaders(fetch, host, {\n    headers: options?.headers\n  });\n  await checkOk(response);\n  return response;\n};\nconst post = async (fetch, host, data, options) => {\n  const isRecord = (input) => {\n    return input !== null && typeof input === \"object\" && !Array.isArray(input);\n  };\n  const formattedData = isRecord(data) ? JSON.stringify(data) : data;\n  const response = await fetchWithHeaders(fetch, host, {\n    method: \"POST\",\n    body: formattedData,\n    signal: options?.signal,\n    headers: options?.headers\n  });\n  await checkOk(response);\n  return response;\n};\nconst del = async (fetch, host, data, options) => {\n  const response = await fetchWithHeaders(fetch, host, {\n    method: \"DELETE\",\n    body: JSON.stringify(data),\n    headers: options?.headers\n  });\n  await checkOk(response);\n  return response;\n};\nconst parseJSON = async function* (itr) {\n  const decoder = new TextDecoder(\"utf-8\");\n  let buffer = \"\";\n  const reader = itr.getReader();\n  while (true) {\n    const { done, value: chunk } = await reader.read();\n    if (done) {\n      break;\n    }\n    buffer += decoder.decode(chunk, { stream: true });\n    const parts = buffer.split(\"\\n\");\n    buffer = parts.pop() ?? \"\";\n    for (const part of parts) {\n      try {\n        yield JSON.parse(part);\n      } catch (error) {\n        console.warn(\"invalid json: \", part);\n      }\n    }\n  }\n  buffer += decoder.decode();\n  for (const part of buffer.split(\"\\n\").filter((p) => p !== \"\")) {\n    try {\n      yield JSON.parse(part);\n    } catch (error) {\n      console.warn(\"invalid json: \", part);\n    }\n  }\n};\nconst formatHost = (host) => {\n  if (!host) {\n    return defaultHost;\n  }\n  let isExplicitProtocol = host.includes(\"://\");\n  if (host.startsWith(\":\")) {\n    host = `http://127.0.0.1${host}`;\n    isExplicitProtocol = true;\n  }\n  if (!isExplicitProtocol) {\n    host = `http://${host}`;\n  }\n  const url = new URL(host);\n  let port = url.port;\n  if (!port) {\n    if (!isExplicitProtocol) {\n      port = defaultPort;\n    } else {\n      port = url.protocol === \"https:\" ? \"443\" : \"80\";\n    }\n  }\n  let auth = \"\";\n  if (url.username) {\n    auth = url.username;\n    if (url.password) {\n      auth += `:${url.password}`;\n    }\n    auth += \"@\";\n  }\n  let formattedHost = `${url.protocol}//${auth}${url.hostname}:${port}${url.pathname}`;\n  if (formattedHost.endsWith(\"/\")) {\n    formattedHost = formattedHost.slice(0, -1);\n  }\n  return formattedHost;\n};\n\nvar __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;\nvar __publicField = (obj, key, value) => {\n  __defNormalProp(obj, typeof key !== \"symbol\" ? key + \"\" : key, value);\n  return value;\n};\nlet Ollama$1 = class Ollama {\n  constructor(config) {\n    __publicField(this, \"config\");\n    __publicField(this, \"fetch\");\n    __publicField(this, \"ongoingStreamedRequests\", []);\n    this.config = {\n      host: \"\",\n      headers: config?.headers\n    };\n    if (!config?.proxy) {\n      this.config.host = formatHost(config?.host ?? defaultHost);\n    }\n    this.fetch = config?.fetch ?? fetch;\n  }\n  // Abort any ongoing streamed requests to Ollama\n  abort() {\n    for (const request of this.ongoingStreamedRequests) {\n      request.abort();\n    }\n    this.ongoingStreamedRequests.length = 0;\n  }\n  /**\n   * Processes a request to the Ollama server. If the request is streamable, it will return a\n   * AbortableAsyncIterator that yields the response messages. Otherwise, it will return the response\n   * object.\n   * @param endpoint {string} - The endpoint to send the request to.\n   * @param request {object} - The request object to send to the endpoint.\n   * @protected {T | AbortableAsyncIterator<T>} - The response object or a AbortableAsyncIterator that yields\n   * response messages.\n   * @throws {Error} - If the response body is missing or if the response is an error.\n   * @returns {Promise<T | AbortableAsyncIterator<T>>} - The response object or a AbortableAsyncIterator that yields the streamed response.\n   */\n  async processStreamableRequest(endpoint, request) {\n    request.stream = request.stream ?? false;\n    const host = `${this.config.host}/api/${endpoint}`;\n    if (request.stream) {\n      const abortController = new AbortController();\n      const response2 = await post(this.fetch, host, request, {\n        signal: abortController.signal,\n        headers: this.config.headers\n      });\n      if (!response2.body) {\n        throw new Error(\"Missing body\");\n      }\n      const itr = parseJSON(response2.body);\n      const abortableAsyncIterator = new AbortableAsyncIterator(\n        abortController,\n        itr,\n        () => {\n          const i = this.ongoingStreamedRequests.indexOf(abortableAsyncIterator);\n          if (i > -1) {\n            this.ongoingStreamedRequests.splice(i, 1);\n          }\n        }\n      );\n      this.ongoingStreamedRequests.push(abortableAsyncIterator);\n      return abortableAsyncIterator;\n    }\n    const response = await post(this.fetch, host, request, {\n      headers: this.config.headers\n    });\n    return await response.json();\n  }\n  /**\n   * Encodes an image to base64 if it is a Uint8Array.\n   * @param image {Uint8Array | string} - The image to encode.\n   * @returns {Promise<string>} - The base64 encoded image.\n   */\n  async encodeImage(image) {\n    if (typeof image !== \"string\") {\n      const uint8Array = new Uint8Array(image);\n      let byteString = \"\";\n      const len = uint8Array.byteLength;\n      for (let i = 0; i < len; i++) {\n        byteString += String.fromCharCode(uint8Array[i]);\n      }\n      return btoa(byteString);\n    }\n    return image;\n  }\n  /**\n   * Generates a response from a text prompt.\n   * @param request {GenerateRequest} - The request object.\n   * @returns {Promise<GenerateResponse | AbortableAsyncIterator<GenerateResponse>>} - The response object or\n   * an AbortableAsyncIterator that yields response messages.\n   */\n  async generate(request) {\n    if (request.images) {\n      request.images = await Promise.all(request.images.map(this.encodeImage.bind(this)));\n    }\n    return this.processStreamableRequest(\"generate\", request);\n  }\n  /**\n   * Chats with the model. The request object can contain messages with images that are either\n   * Uint8Arrays or base64 encoded strings. The images will be base64 encoded before sending the\n   * request.\n   * @param request {ChatRequest} - The request object.\n   * @returns {Promise<ChatResponse | AbortableAsyncIterator<ChatResponse>>} - The response object or an\n   * AbortableAsyncIterator that yields response messages.\n   */\n  async chat(request) {\n    if (request.messages) {\n      for (const message of request.messages) {\n        if (message.images) {\n          message.images = await Promise.all(\n            message.images.map(this.encodeImage.bind(this))\n          );\n        }\n      }\n    }\n    return this.processStreamableRequest(\"chat\", request);\n  }\n  /**\n   * Creates a new model from a stream of data.\n   * @param request {CreateRequest} - The request object.\n   * @returns {Promise<ProgressResponse | AbortableAsyncIterator<ProgressResponse>>} - The response object or a stream of progress responses.\n   */\n  async create(request) {\n    return this.processStreamableRequest(\"create\", {\n      ...request\n    });\n  }\n  /**\n   * Pulls a model from the Ollama registry. The request object can contain a stream flag to indicate if the\n   * response should be streamed.\n   * @param request {PullRequest} - The request object.\n   * @returns {Promise<ProgressResponse | AbortableAsyncIterator<ProgressResponse>>} - The response object or\n   * an AbortableAsyncIterator that yields response messages.\n   */\n  async pull(request) {\n    return this.processStreamableRequest(\"pull\", {\n      name: request.model,\n      stream: request.stream,\n      insecure: request.insecure\n    });\n  }\n  /**\n   * Pushes a model to the Ollama registry. The request object can contain a stream flag to indicate if the\n   * response should be streamed.\n   * @param request {PushRequest} - The request object.\n   * @returns {Promise<ProgressResponse | AbortableAsyncIterator<ProgressResponse>>} - The response object or\n   * an AbortableAsyncIterator that yields response messages.\n   */\n  async push(request) {\n    return this.processStreamableRequest(\"push\", {\n      name: request.model,\n      stream: request.stream,\n      insecure: request.insecure\n    });\n  }\n  /**\n   * Deletes a model from the server. The request object should contain the name of the model to\n   * delete.\n   * @param request {DeleteRequest} - The request object.\n   * @returns {Promise<StatusResponse>} - The response object.\n   */\n  async delete(request) {\n    await del(\n      this.fetch,\n      `${this.config.host}/api/delete`,\n      { name: request.model },\n      { headers: this.config.headers }\n    );\n    return { status: \"success\" };\n  }\n  /**\n   * Copies a model from one name to another. The request object should contain the name of the\n   * model to copy and the new name.\n   * @param request {CopyRequest} - The request object.\n   * @returns {Promise<StatusResponse>} - The response object.\n   */\n  async copy(request) {\n    await post(this.fetch, `${this.config.host}/api/copy`, { ...request }, {\n      headers: this.config.headers\n    });\n    return { status: \"success\" };\n  }\n  /**\n   * Lists the models on the server.\n   * @returns {Promise<ListResponse>} - The response object.\n   * @throws {Error} - If the response body is missing.\n   */\n  async list() {\n    const response = await get(this.fetch, `${this.config.host}/api/tags`, {\n      headers: this.config.headers\n    });\n    return await response.json();\n  }\n  /**\n   * Shows the metadata of a model. The request object should contain the name of the model.\n   * @param request {ShowRequest} - The request object.\n   * @returns {Promise<ShowResponse>} - The response object.\n   */\n  async show(request) {\n    const response = await post(this.fetch, `${this.config.host}/api/show`, {\n      ...request\n    }, {\n      headers: this.config.headers\n    });\n    return await response.json();\n  }\n  /**\n   * Embeds text input into vectors.\n   * @param request {EmbedRequest} - The request object.\n   * @returns {Promise<EmbedResponse>} - The response object.\n   */\n  async embed(request) {\n    const response = await post(this.fetch, `${this.config.host}/api/embed`, {\n      ...request\n    }, {\n      headers: this.config.headers\n    });\n    return await response.json();\n  }\n  /**\n   * Embeds a text prompt into a vector.\n   * @param request {EmbeddingsRequest} - The request object.\n   * @returns {Promise<EmbeddingsResponse>} - The response object.\n   */\n  async embeddings(request) {\n    const response = await post(this.fetch, `${this.config.host}/api/embeddings`, {\n      ...request\n    }, {\n      headers: this.config.headers\n    });\n    return await response.json();\n  }\n  /**\n   * Lists the running models on the server\n   * @returns {Promise<ListResponse>} - The response object.\n   * @throws {Error} - If the response body is missing.\n   */\n  async ps() {\n    const response = await get(this.fetch, `${this.config.host}/api/ps`, {\n      headers: this.config.headers\n    });\n    return await response.json();\n  }\n  /**\n   * Returns the Ollama server version.\n   * @returns {Promise<VersionResponse>} - The server version object.\n   */\n  async version() {\n    const response = await get(this.fetch, `${this.config.host}/api/version`, {\n      headers: this.config.headers\n    });\n    return await response.json();\n  }\n  /**\n   * Performs web search using the Ollama web search API\n   * @param request {WebSearchRequest} - The search request containing query and options\n   * @returns {Promise<WebSearchResponse>} - The search results\n   * @throws {Error} - If the request is invalid or the server returns an error\n   */\n  async webSearch(request) {\n    if (!request.query || request.query.length === 0) {\n      throw new Error(\"Query is required\");\n    }\n    const response = await post(this.fetch, `https://ollama.com/api/web_search`, { ...request }, {\n      headers: this.config.headers\n    });\n    return await response.json();\n  }\n  /**\n   * Fetches a single page using the Ollama web fetch API\n   * @param request {WebFetchRequest} - The fetch request containing a URL\n   * @returns {Promise<WebFetchResponse>} - The fetch result\n   * @throws {Error} - If the request is invalid or the server returns an error\n   */\n  async webFetch(request) {\n    if (!request.url || request.url.length === 0) {\n      throw new Error(\"URL is required\");\n    }\n    const response = await post(this.fetch, `https://ollama.com/api/web_fetch`, { ...request }, { headers: this.config.headers });\n    return await response.json();\n  }\n};\nconst browser = new Ollama$1();\n\nexport { Ollama$1 as Ollama, browser as default };\n","import { Embeddings, EmbeddingsParams } from \"@langchain/core/embeddings\";\nimport { getEnvironmentVariable } from \"@langchain/core/utils/env\";\n// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore CJS type resolution workaround\nimport { Ollama } from \"ollama/browser\";\nimport type { Options as OllamaOptions } from \"ollama\";\nimport { OllamaCamelCaseOptions } from \"./types.js\";\n\n/**\n * Interface for OllamaEmbeddings parameters. Extends EmbeddingsParams and\n * defines additional parameters specific to the OllamaEmbeddings class.\n */\nexport interface OllamaEmbeddingsParams extends EmbeddingsParams {\n  /**\n   * The Ollama model to use for embeddings.\n   * @default \"mxbai-embed-large\"\n   */\n  model?: string;\n\n  /**\n   * Base URL of the Ollama server.\n   * Defaults to `OLLAMA_BASE_URL` if set.\n   * @default \"http://localhost:11434\"\n   */\n  baseUrl?: string;\n\n  /**\n   * The number of dimensions for the embeddings.\n   */\n  dimensions?: number;\n\n  /**\n   * Defaults to \"5m\"\n   */\n  keepAlive?: string | number;\n\n  /**\n   * Whether or not to truncate the input text to fit inside the model's\n   * context window.\n   * @default false\n   */\n  truncate?: boolean;\n\n  /**\n   * Optional HTTP Headers to include in the request.\n   */\n  headers?: Headers | Record<string, string>;\n\n  /**\n   * Advanced Ollama API request parameters in camelCase, see\n   * https://github.com/ollama/ollama/blob/main/docs/modelfile.md#valid-parameters-and-values\n   * for details of the available parameters.\n   */\n  requestOptions?: OllamaCamelCaseOptions & Partial<OllamaOptions>;\n\n  /**\n   * The fetch function to use.\n   * @default fetch\n   */\n  fetch?: typeof fetch;\n}\n\nexport class OllamaEmbeddings extends Embeddings {\n  model = \"mxbai-embed-large\";\n\n  baseUrl = \"http://localhost:11434\";\n\n  dimensions?: number;\n\n  keepAlive?: string | number;\n\n  requestOptions?: Partial<OllamaOptions>;\n\n  client: Ollama;\n\n  truncate = false;\n\n  constructor(fields?: OllamaEmbeddingsParams) {\n    super({ maxConcurrency: 1, ...fields });\n\n    this.baseUrl =\n      fields?.baseUrl ??\n      getEnvironmentVariable(\"OLLAMA_BASE_URL\") ??\n      this.baseUrl;\n    this.client = new Ollama({\n      fetch: fields?.fetch,\n      host: this.baseUrl,\n      headers: fields?.headers ? new Headers(fields.headers) : undefined,\n    });\n\n    this.model = fields?.model ?? this.model;\n    this.dimensions = fields?.dimensions;\n    this.keepAlive = fields?.keepAlive;\n    this.truncate = fields?.truncate ?? this.truncate;\n    this.requestOptions = fields?.requestOptions\n      ? this._convertOptions(fields?.requestOptions)\n      : undefined;\n  }\n\n  /** convert camelCased Ollama request options like \"useMMap\" to\n   * the snake_cased equivalent which the ollama API actually uses.\n   * Used only for consistency with the llms/Ollama and chatModels/Ollama classes\n   */\n  _convertOptions(\n    requestOptions: OllamaCamelCaseOptions\n  ): Partial<OllamaOptions> {\n    const snakeCasedOptions: Partial<OllamaOptions> = {};\n    const mapping: Record<keyof OllamaCamelCaseOptions, string> = {\n      embeddingOnly: \"embedding_only\",\n      frequencyPenalty: \"frequency_penalty\",\n      keepAlive: \"keep_alive\",\n      logitsAll: \"logits_all\",\n      lowVram: \"low_vram\",\n      mainGpu: \"main_gpu\",\n      mirostat: \"mirostat\",\n      mirostatEta: \"mirostat_eta\",\n      mirostatTau: \"mirostat_tau\",\n      numBatch: \"num_batch\",\n      numCtx: \"num_ctx\",\n      numGpu: \"num_gpu\",\n      numKeep: \"num_keep\",\n      numPredict: \"num_predict\",\n      numThread: \"num_thread\",\n      penalizeNewline: \"penalize_newline\",\n      presencePenalty: \"presence_penalty\",\n      repeatLastN: \"repeat_last_n\",\n      repeatPenalty: \"repeat_penalty\",\n      temperature: \"temperature\",\n      stop: \"stop\",\n      tfsZ: \"tfs_z\",\n      topK: \"top_k\",\n      topP: \"top_p\",\n      typicalP: \"typical_p\",\n      useMlock: \"use_mlock\",\n      useMmap: \"use_mmap\",\n      vocabOnly: \"vocab_only\",\n      f16Kv: \"f16_kv\",\n      numa: \"numa\",\n      seed: \"seed\",\n    };\n\n    for (const [key, value] of Object.entries(requestOptions)) {\n      const snakeCasedOption = mapping[key as keyof OllamaCamelCaseOptions];\n      if (snakeCasedOption) {\n        snakeCasedOptions[snakeCasedOption as keyof OllamaOptions] = value;\n      } else {\n        // Just pass unknown options through\n        snakeCasedOptions[key as keyof OllamaOptions] = value;\n      }\n    }\n    return snakeCasedOptions;\n  }\n\n  async embedDocuments(texts: string[]): Promise<number[][]> {\n    return this.embeddingWithRetry(texts);\n  }\n\n  async embedQuery(text: string) {\n    return (await this.embeddingWithRetry([text]))[0];\n  }\n\n  private async embeddingWithRetry(texts: string[]): Promise<number[][]> {\n    const res = await this.caller.call(() =>\n      this.client.embed({\n        model: this.model,\n        input: texts,\n        dimensions: this.dimensions,\n        keep_alive: this.keepAlive,\n        options: this.requestOptions,\n        truncate: this.truncate,\n      })\n    );\n    return res.embeddings;\n  }\n}\n","import debug from \"debug\";\nimport { DryScanServiceDeps } from \"./types\";\nimport { ExclusionService } from \"./ExclusionService\";\nimport { performIncrementalUpdate } from \"../DryScanUpdater\";\nimport { DuplicationCache } from \"./DuplicationCache\";\n\nconst log = debug(\"DryScan:UpdateService\");\n\nexport class UpdateService {\n  constructor(\n    private readonly deps: DryScanServiceDeps,\n    private readonly exclusionService: ExclusionService\n  ) {}\n\n  async updateIndex(): Promise<void> {\n    const extractor = this.deps.extractor;\n    const cache = DuplicationCache.getInstance();\n\n    try {\n      const changeSet = await performIncrementalUpdate(this.deps.repoPath, extractor, this.deps.db);\n      await this.exclusionService.cleanupExcludedFiles();\n      await cache.invalidate([...changeSet.changed, ...changeSet.deleted]);\n    } catch (err) {\n      log(\"Error during index update:\", err);\n      throw err;\n    }\n  }\n}","import path from \"path\";\nimport fs from \"fs/promises\";\nimport debug from \"debug\";\nimport { IndexUnit } from \"./types\";\nimport { IndexUnitExtractor } from \"./IndexUnitExtractor\";\nimport { DryScanDatabase } from \"./db/DryScanDatabase\";\nimport { FileEntity } from \"./db/entities/FileEntity\";\nimport { EmbeddingService } from \"./services/EmbeddingService\";\n\nconst log = debug(\"DryScan:Updater\");\n\n/**\n * DryScan Updater Module\n * \n * This module contains all incremental update logic for DryScan.\n * Separated from DryScan.ts to keep that file focused on core operations.\n * \n * Represents the result of change detection.\n * Categorizes files into added, changed, deleted, and unchanged.\n */\nexport interface FileChangeSet {\n  added: string[];\n  changed: string[];\n  deleted: string[];\n  unchanged: string[];\n}\n\n/**\n * Detects which files have been added, changed, or deleted since last scan.\n * Uses mtime as fast check, then checksum for verification.\n * \n * @param repoPath - Root path of the repository\n * @param extractor - Index unit extractor instance for file operations\n * @param db - Database instance for retrieving tracked files\n * @returns Change set with categorized file paths\n */\nexport async function detectFileChanges(\n  repoPath: string,\n  extractor: IndexUnitExtractor,\n  db: DryScanDatabase\n): Promise<FileChangeSet> {\n  // Get current files in repository\n  const currentFiles = await extractor.listSourceFiles(repoPath);\n  const currentFileSet = new Set(currentFiles);\n\n  // Get tracked files from database\n  const trackedFiles = await db.getAllFiles();\n  const trackedFileMap = new Map(trackedFiles.map(f => [f.filePath, f]));\n\n  const added: string[] = [];\n  const changed: string[] = [];\n  const unchanged: string[] = [];\n\n  // Check each current file\n  for (const filePath of currentFiles) {\n    const tracked = trackedFileMap.get(filePath);\n    \n    if (!tracked) {\n      // New file\n      added.push(filePath);\n      continue;\n    }\n\n    // Check if file changed using mtime first (fast check)\n    const fullPath = path.join(repoPath, filePath);\n    const stat = await fs.stat(fullPath);\n    \n    if (stat.mtimeMs !== tracked.mtime) {\n      // Mtime changed, verify with checksum\n      const currentChecksum = await extractor.computeChecksum(fullPath);\n      if (currentChecksum !== tracked.checksum) {\n        changed.push(filePath);\n      } else {\n        // Mtime changed but content same\n        unchanged.push(filePath);\n      }\n    } else {\n      unchanged.push(filePath);\n    }\n  }\n\n  // Find deleted files\n  const deleted = trackedFiles\n    .map(f => f.filePath)\n    .filter(fp => !currentFileSet.has(fp));\n\n  return { added, changed, deleted, unchanged };\n}\n\n/**\n * Extracts index units from a list of files.\n * Used during incremental updates.\n * \n * @param filePaths - Array of relative file paths to extract from\n * @param extractor - Index unit extractor instance\n * @returns Array of extracted units\n */\nexport async function extractUnitsFromFiles(\n  filePaths: string[],\n  extractor: IndexUnitExtractor\n): Promise<IndexUnit[]> {\n  const allUnits: IndexUnit[] = [];\n  \n  for (const relPath of filePaths) {\n    const functions = await extractor.scan(relPath);\n    allUnits.push(...functions);\n  }\n  \n  return allUnits;\n}\n\n/**\n * Updates file tracking metadata after processing changes.\n * Removes deleted files, updates changed files, adds new files.\n * \n * @param changeSet - Set of file changes to apply\n * @param repoPath - Root path of the repository\n * @param extractor - Index unit extractor for checksum computation\n * @param db - Database instance for file tracking\n */\nexport async function updateFileTracking(\n  changeSet: FileChangeSet,\n  repoPath: string,\n  extractor: IndexUnitExtractor,\n  db: DryScanDatabase\n): Promise<void> {\n  // Remove deleted files\n  if (changeSet.deleted.length > 0) {\n    if (typeof (db as any).removeFilesByFilePaths === \"function\") {\n      await (db as any).removeFilesByFilePaths(changeSet.deleted);\n    } else if (typeof (db as any).removeFiles === \"function\") {\n      await (db as any).removeFiles(changeSet.deleted);\n    }\n  }\n\n  // Create file entities for new and changed files\n  const filesToTrack = [...changeSet.added, ...changeSet.changed];\n  if (filesToTrack.length > 0) {\n    const fileEntities: FileEntity[] = [];\n    \n    for (const relPath of filesToTrack) {\n      const fullPath = path.join(repoPath, relPath);\n      const stat = await fs.stat(fullPath);\n      const checksum = await extractor.computeChecksum(fullPath);\n      \n      const fileEntity = new FileEntity();\n      fileEntity.filePath = relPath;\n      fileEntity.checksum = checksum;\n      fileEntity.mtime = stat.mtimeMs;\n      \n      fileEntities.push(fileEntity);\n    }\n    \n    await db.saveFiles(fileEntities);\n  }\n}\n\n/**\n * Performs incremental update of the DryScan index.\n * Detects file changes and reprocesses only affected files.\n * \n * @param repoPath - Root path of the repository\n * @param extractor - Index unit extractor instance\n * @param db - Database instance (must be initialized)\n */\nexport async function performIncrementalUpdate(\n  repoPath: string,\n  extractor: IndexUnitExtractor,\n  db: DryScanDatabase,\n): Promise<FileChangeSet> {\n  log(\"Starting incremental update\");\n  const embeddingService = new EmbeddingService(repoPath);\n  \n  // Step 1: Detect changes\n  const changeSet = await detectFileChanges(repoPath, extractor, db);\n  \n  if (changeSet.changed.length === 0 && \n      changeSet.added.length === 0 && \n      changeSet.deleted.length === 0) {\n    log(\"No changes detected. Index is up to date.\");\n    return changeSet;\n  }\n\n  log(`Changes detected: ${changeSet.added.length} added, ${changeSet.changed.length} changed, ${changeSet.deleted.length} deleted`);\n\n  // Step 2: Remove old data for changed/deleted files\n  const filesToRemove = [...changeSet.changed, ...changeSet.deleted];\n  if (filesToRemove.length > 0) {\n      await db.removeUnitsByFilePaths(filesToRemove);\n      log(`Removed units from ${filesToRemove.length} files`);\n  }\n\n  // Step 3: Extract functions from new/changed files\n  const filesToProcess = [...changeSet.added, ...changeSet.changed];\n  if (filesToProcess.length > 0) {\n    const newUnits = await extractUnitsFromFiles(filesToProcess, extractor);\n      await db.saveUnits(newUnits);\n      log(`Extracted and saved ${newUnits.length} units from ${filesToProcess.length} files`);\n\n    // Step 4: Recompute embeddings for affected units only\n    const total = newUnits.length;\n    if (total > 0) {\n      log(`Recomputing embeddings for ${total} units`);\n      const progressInterval = Math.max(1, Math.ceil(total / 10));\n      const updatedWithEmbeddings = [] as IndexUnit[];\n\n      for (let i = 0; i < total; i++) {\n        const unit = newUnits[i];\n        try {\n          const enriched = await embeddingService.addEmbedding(unit);\n          updatedWithEmbeddings.push(enriched);\n        } catch (err: any) {\n          console.error(\n            `[DryScan] embedding failed for ${unit.filePath} (${unit.name}): ${err?.message || err}`\n          );\n          throw err;\n        }\n\n        const completed = i + 1;\n        if (completed === total || completed % progressInterval === 0) {\n          const pct = Math.floor((completed / total) * 100);\n          console.log(`[DryScan] Incremental embeddings ${completed}/${total} (${pct}%)`);\n        }\n      }\n\n      await db.updateUnits(updatedWithEmbeddings);\n      log(`Recomputed embeddings for ${updatedWithEmbeddings.length} units`);\n    }\n  }\n\n  // Step 5: Update file tracking\n  await updateFileTracking(changeSet, repoPath, extractor, db);\n  log(\"Incremental update complete\");\n\n  return changeSet;\n}\n","import { DuplicateGroup } from \"../types\";\n\n/**\n * In-memory cache for duplicate comparison scores.\n * Stores a global map of comparison keys and a per-file index for fast invalidation.\n */\nexport class DuplicationCache {\n  private static instance: DuplicationCache | null = null;\n\n  private readonly comparisons = new Map<string, number>();\n  private readonly fileIndex = new Map<string, Set<string>>();\n  private initialized = false;\n\n  static getInstance(): DuplicationCache {\n    if (!DuplicationCache.instance) {\n      DuplicationCache.instance = new DuplicationCache();\n    }\n    return DuplicationCache.instance;\n  }\n\n  /**\n   * Updates the cache with fresh duplicate groups. Not awaited by callers to avoid blocking.\n   */\n  async update(groups: DuplicateGroup[]): Promise<void> {\n    if (!groups) return;\n\n    for (const group of groups) {\n      const key = this.makeKey(group.left.id, group.right.id);\n      this.comparisons.set(key, group.similarity);\n      this.addKeyForFile(group.left.filePath, key);\n      this.addKeyForFile(group.right.filePath, key);\n    }\n\n    this.initialized = this.initialized || groups.length > 0;\n  }\n\n  /**\n   * Retrieves a cached similarity if present and valid for both file paths.\n   * Returns null when the cache has not been initialized or when the pair is missing.\n   */\n  get(leftId: string, rightId: string, leftFilePath: string, rightFilePath: string): number | null {\n    if (!this.initialized) return null;\n\n    const key = this.makeKey(leftId, rightId);\n    if (!this.fileHasKey(leftFilePath, key) || !this.fileHasKey(rightFilePath, key)) {\n      return null;\n    }\n\n    const value = this.comparisons.get(key);\n    return typeof value === \"number\" ? value : null;\n  }\n\n  /**\n   * Invalidates all cached comparisons involving the provided file paths.\n   */\n  async invalidate(paths: string[]): Promise<void> {\n    if (!this.initialized || !paths || paths.length === 0) return;\n\n    const unique = new Set(paths);\n    for (const filePath of unique) {\n      const keys = this.fileIndex.get(filePath);\n      if (!keys) continue;\n\n      for (const key of keys) {\n        this.comparisons.delete(key);\n        for (const [otherPath, otherKeys] of this.fileIndex.entries()) {\n          if (otherKeys.delete(key) && otherKeys.size === 0) {\n            this.fileIndex.delete(otherPath);\n          }\n        }\n      }\n\n      this.fileIndex.delete(filePath);\n    }\n\n    if (this.comparisons.size === 0) {\n      this.initialized = false;\n    }\n  }\n\n  /**\n   * Clears all cached data. Intended for test setup.\n   */\n  clear(): void {\n    this.comparisons.clear();\n    this.fileIndex.clear();\n    this.initialized = false;\n  }\n\n  private addKeyForFile(filePath: string, key: string): void {\n    const current = this.fileIndex.get(filePath) ?? new Set<string>();\n    current.add(key);\n    this.fileIndex.set(filePath, current);\n  }\n\n  private fileHasKey(filePath: string, key: string): boolean {\n    const keys = this.fileIndex.get(filePath);\n    return keys ? keys.has(key) : false;\n  }\n\n  private makeKey(leftId: string, rightId: string): string {\n    return [leftId, rightId].sort().join(\"::\");\n  }\n}\n","import debug from \"debug\";\nimport shortUuid from \"short-uuid\";\nimport { cosineSimilarity } from \"@langchain/core/utils/math\";\nimport { DryScanServiceDeps } from \"./types\";\nimport { DuplicateAnalysisResult, DuplicateGroup, DuplicationScore, IndexUnit, IndexUnitType } from \"../types\";\nimport { indexConfig } from \"../config/indexConfig\";\nimport { DryConfig } from \"../types\";\nimport { DuplicationCache } from \"./DuplicationCache\";\n\nconst log = debug(\"DryScan:DuplicateService\");\n\nexport class DuplicateService {\n  private config?: DryConfig;\n  private readonly cache = DuplicationCache.getInstance();\n\n  constructor(private readonly deps: DryScanServiceDeps) {}\n\n  async findDuplicates(config: DryConfig): Promise<DuplicateAnalysisResult> {\n    this.config = config;\n    const allUnits = await this.deps.db.getAllUnits();\n    if (allUnits.length < 2) {\n      const score = this.computeDuplicationScore([], allUnits);\n      return { duplicates: [], score };\n    }\n\n    const thresholds = this.resolveThresholds(config.threshold);\n    const duplicates = this.computeDuplicates(allUnits, thresholds);\n    const filteredDuplicates = duplicates.filter((group) => !this.isGroupExcluded(group));\n    log(\"Found %d duplicate groups\", filteredDuplicates.length);\n\n    // Update cache asynchronously; no need to block the main flow.\n    this.cache.update(filteredDuplicates).catch((err) => log(\"Cache update failed: %O\", err));\n\n    const score = this.computeDuplicationScore(filteredDuplicates, allUnits);\n    return { duplicates: filteredDuplicates, score };\n  }\n\n  private resolveThresholds(functionThreshold?: number): { function: number; block: number; class: number } {\n    const defaults = indexConfig.thresholds;\n    const clamp = (value: number) => Math.min(1, Math.max(0, value));\n\n    const base = functionThreshold ?? defaults.function;\n    const blockOffset = defaults.block - defaults.function;\n    const classOffset = defaults.class - defaults.function;\n\n    const functionThresholdValue = clamp(base);\n    return {\n      function: functionThresholdValue,\n      block: clamp(functionThresholdValue + blockOffset),\n      class: clamp(functionThresholdValue + classOffset),\n    };\n  }\n\n  private computeDuplicates(\n    units: IndexUnit[],\n    thresholds: { function: number; block: number; class: number }\n  ): DuplicateGroup[] {\n    const duplicates: DuplicateGroup[] = [];\n    const byType = new Map<IndexUnitType, IndexUnit[]>();\n\n    for (const unit of units) {\n      const list = byType.get(unit.unitType) ?? [];\n      list.push(unit);\n      byType.set(unit.unitType, list);\n    }\n\n    for (const [type, typedUnits] of byType.entries()) {\n      const threshold = this.getThreshold(type, thresholds);\n\n      for (let i = 0; i < typedUnits.length; i++) {\n        for (let j = i + 1; j < typedUnits.length; j++) {\n          const left = typedUnits[i];\n          const right = typedUnits[j];\n\n          if (this.shouldSkipComparison(left, right)) continue;\n\n          const cached = this.cache.get(left.id, right.id, left.filePath, right.filePath);\n          let similarity: number | null = null;\n\n          if (cached !== null) {\n            similarity = cached;\n          } else {\n            if (!left.embedding || !right.embedding) continue;\n            similarity = this.computeWeightedSimilarity(left, right);\n          }\n\n          if (similarity === null) continue;\n\n          if (similarity >= threshold) {\n            const exclusionString = this.deps.pairing.pairKeyForUnits(left, right);\n            if (!exclusionString) continue;\n\n            duplicates.push({\n              id: `${left.id}::${right.id}`,\n              similarity,\n              shortId: shortUuid.generate(),\n              exclusionString,\n              left: {\n                id: left.id,\n                name: left.name,\n                filePath: left.filePath,\n                startLine: left.startLine,\n                endLine: left.endLine,\n                code: left.code,\n                unitType: left.unitType,\n              },\n              right: {\n                id: right.id,\n                name: right.name,\n                filePath: right.filePath,\n                startLine: right.startLine,\n                endLine: right.endLine,\n                code: right.code,\n                unitType: right.unitType,\n              },\n            });\n          }\n        }\n      }\n    }\n\n    return duplicates.sort((a, b) => b.similarity - a.similarity);\n  }\n\n  private isGroupExcluded(group: DuplicateGroup): boolean {\n    const config = this.config;\n    if (!config || !config.excludedPairs || config.excludedPairs.length === 0) return false;\n    const key = this.deps.pairing.pairKeyForUnits(group.left, group.right);\n    if (!key) return false;\n    const actual = this.deps.pairing.parsePairKey(key);\n    if (!actual) return false;\n    return config.excludedPairs.some((entry) => {\n      const parsed = this.deps.pairing.parsePairKey(entry);\n      return parsed ? this.deps.pairing.pairKeyMatches(actual, parsed) : false;\n    });\n  }\n\n  private getThreshold(type: IndexUnitType, thresholds: { function: number; block: number; class: number }): number {\n    if (type === IndexUnitType.CLASS) return thresholds.class;\n    if (type === IndexUnitType.BLOCK) return thresholds.block;\n    return thresholds.function;\n  }\n\n  private computeWeightedSimilarity(left: IndexUnit, right: IndexUnit): number {\n    const selfSimilarity = this.similarityWithFallback(left, right);\n\n    if (left.unitType === IndexUnitType.CLASS) {\n      return selfSimilarity * indexConfig.weights.class.self;\n    }\n\n    if (left.unitType === IndexUnitType.FUNCTION) {\n      const weights = indexConfig.weights.function;\n      const hasParentClass = !!this.findParentOfType(left, IndexUnitType.CLASS) && !!this.findParentOfType(right, IndexUnitType.CLASS);\n      const parentClassSimilarity = hasParentClass ? this.parentSimilarity(left, right, IndexUnitType.CLASS) : 0;\n\n      // Re-normalize weights when parent context is missing, so standalone units aren't penalized.\n      const totalWeight = weights.self + (hasParentClass ? weights.parentClass : 0);\n      return ((weights.self * selfSimilarity) + (hasParentClass ? (weights.parentClass * parentClassSimilarity) : 0)) / totalWeight;\n    }\n\n    const weights = indexConfig.weights.block;\n    const hasParentFunction = !!this.findParentOfType(left, IndexUnitType.FUNCTION) && !!this.findParentOfType(right, IndexUnitType.FUNCTION);\n    const hasParentClass = !!this.findParentOfType(left, IndexUnitType.CLASS) && !!this.findParentOfType(right, IndexUnitType.CLASS);\n    const parentFuncSim = hasParentFunction ? this.parentSimilarity(left, right, IndexUnitType.FUNCTION) : 0;\n    const parentClassSim = hasParentClass ? this.parentSimilarity(left, right, IndexUnitType.CLASS) : 0;\n\n    // Re-normalize weights when some parent context is missing.\n    const totalWeight =\n      weights.self +\n      (hasParentFunction ? weights.parentFunction : 0) +\n      (hasParentClass ? weights.parentClass : 0);\n\n    return (\n      (weights.self * selfSimilarity) +\n      (hasParentFunction ? (weights.parentFunction * parentFuncSim) : 0) +\n      (hasParentClass ? (weights.parentClass * parentClassSim) : 0)\n    ) / totalWeight;\n  }\n\n  private parentSimilarity(left: IndexUnit, right: IndexUnit, targetType: IndexUnitType): number {\n    const leftParent = this.findParentOfType(left, targetType);\n    const rightParent = this.findParentOfType(right, targetType);\n    if (!leftParent || !rightParent) return 0;\n    return this.similarityWithFallback(leftParent, rightParent);\n  }\n\n  private similarityWithFallback(left: IndexUnit, right: IndexUnit): number {\n    const leftHasEmbedding = this.hasVector(left);\n    const rightHasEmbedding = this.hasVector(right);\n\n    if (leftHasEmbedding && rightHasEmbedding) {\n      return cosineSimilarity([left.embedding as number[]], [right.embedding as number[]])[0][0];\n    }\n\n    return this.childSimilarity(left, right);\n  }\n\n  private childSimilarity(left: IndexUnit, right: IndexUnit): number {\n    const leftChildren = left.children ?? [];\n    const rightChildren = right.children ?? [];\n    if (leftChildren.length === 0 || rightChildren.length === 0) return 0;\n\n    let best = 0;\n    for (const lChild of leftChildren) {\n      for (const rChild of rightChildren) {\n        if (lChild.unitType !== rChild.unitType) continue;\n        const sim = this.similarityWithFallback(lChild, rChild);\n        if (sim > best) best = sim;\n      }\n    }\n    return best;\n  }\n\n  private hasVector(unit: IndexUnit): boolean {\n    return Array.isArray(unit.embedding) && unit.embedding.length > 0;\n  }\n\n  private shouldSkipComparison(left: IndexUnit, right: IndexUnit): boolean {\n    if (left.unitType !== IndexUnitType.BLOCK || right.unitType !== IndexUnitType.BLOCK) {\n      return false;\n    }\n\n    if (left.filePath !== right.filePath) {\n      return false;\n    }\n\n    const leftContainsRight = left.startLine <= right.startLine && left.endLine >= right.endLine;\n    const rightContainsLeft = right.startLine <= left.startLine && right.endLine >= left.endLine;\n    return leftContainsRight || rightContainsLeft;\n  }\n\n  private findParentOfType(unit: IndexUnit, targetType: IndexUnitType): IndexUnit | null {\n    let current: IndexUnit | undefined | null = unit.parent;\n    while (current) {\n      if (current.unitType === targetType) return current;\n      current = current.parent;\n    }\n    return null;\n  }\n\n  private computeDuplicationScore(duplicates: DuplicateGroup[], allUnits: IndexUnit[]): DuplicationScore {\n    const totalLines = this.calculateTotalLines(allUnits);\n\n    if (totalLines === 0 || duplicates.length === 0) {\n      return {\n        score: 0,\n        grade: \"Excellent\",\n        totalLines,\n        duplicateLines: 0,\n        duplicateGroups: 0,\n      };\n    }\n\n    const weightedDuplicateLines = duplicates.reduce((sum, group) => {\n      const leftLines = group.left.endLine - group.left.startLine + 1;\n      const rightLines = group.right.endLine - group.right.startLine + 1;\n      const avgLines = (leftLines + rightLines) / 2;\n      return sum + group.similarity * avgLines;\n    }, 0);\n\n    const score = (weightedDuplicateLines / totalLines) * 100;\n    const grade = this.getScoreGrade(score);\n\n    return {\n      score,\n      grade,\n      totalLines,\n      duplicateLines: Math.round(weightedDuplicateLines),\n      duplicateGroups: duplicates.length,\n    };\n  }\n\n  private calculateTotalLines(units: IndexUnit[]): number {\n    return units.reduce((sum, unit) => {\n      const lines = unit.endLine - unit.startLine + 1;\n      return sum + lines;\n    }, 0);\n  }\n\n  private getScoreGrade(score: number): DuplicationScore[\"grade\"] {\n    if (score < 5) return \"Excellent\";\n    if (score < 15) return \"Good\";\n    if (score < 30) return \"Fair\";\n    if (score < 50) return \"Poor\";\n    return \"Critical\";\n  }\n}","import { DryConfig } from \"../types\";\nimport { configStore } from \"../config/configStore\";\nimport { DryScanServiceDeps } from \"./types\";\nimport { IndexUnitType } from \"../types\";\nimport { minimatch } from \"minimatch\";\nimport { ParsedPairKey } from \"./PairingService\";\n\nexport class ExclusionService {\n  private config?: DryConfig;\n\n  constructor(private readonly deps: DryScanServiceDeps) {}\n\n  async cleanupExcludedFiles(): Promise<void> {\n    const config = await this.loadConfig();\n    if (!config.excludedPaths || config.excludedPaths.length === 0) return;\n\n    const units = await this.deps.db.getAllUnits();\n    const files = await this.deps.db.getAllFiles();\n\n    const unitPathsToRemove = new Set<string>();\n    for (const unit of units) {\n      if (this.pathExcluded(unit.filePath)) {\n        unitPathsToRemove.add(unit.filePath);\n      }\n    }\n\n    const filePathsToRemove = new Set<string>();\n    for (const file of files) {\n      if (this.pathExcluded(file.filePath)) {\n        filePathsToRemove.add(file.filePath);\n      }\n    }\n\n    const paths = [...new Set([...unitPathsToRemove, ...filePathsToRemove])];\n    if (paths.length > 0) {\n      await this.deps.db.removeUnitsByFilePaths(paths);\n      await this.deps.db.removeFilesByFilePaths(paths);\n    }\n  }\n\n  async cleanExclusions(): Promise<{ removed: number; kept: number }> {\n    const config = await this.loadConfig();\n    const units = await this.deps.db.getAllUnits();\n\n    const actualPairsByType = {\n      [IndexUnitType.CLASS]: this.buildPairKeys(units, IndexUnitType.CLASS),\n      [IndexUnitType.FUNCTION]: this.buildPairKeys(units, IndexUnitType.FUNCTION),\n      [IndexUnitType.BLOCK]: this.buildPairKeys(units, IndexUnitType.BLOCK),\n    };\n\n    const kept: string[] = [];\n    const removed: string[] = [];\n\n    for (const entry of config.excludedPairs || []) {\n      const parsed = this.deps.pairing.parsePairKey(entry);\n      if (!parsed) {\n        removed.push(entry);\n        continue;\n      }\n\n      const candidates = actualPairsByType[parsed.type];\n      const matched = candidates.some((actual) => this.deps.pairing.pairKeyMatches(actual, parsed));\n      if (matched) {\n        kept.push(entry);\n      } else {\n        removed.push(entry);\n      }\n    }\n\n    const nextConfig: DryConfig = { ...config, excludedPairs: kept };\n    await configStore.save(this.deps.repoPath, nextConfig);\n    this.config = nextConfig;\n\n    return { removed: removed.length, kept: kept.length };\n  }\n\n  private pathExcluded(filePath: string): boolean {\n    const config = this.config;\n    if (!config || !config.excludedPaths || config.excludedPaths.length === 0) return false;\n    return config.excludedPaths.some((pattern) => minimatch(filePath, pattern, { dot: true }));\n  }\n\n  private buildPairKeys(units: any[], type: IndexUnitType): ParsedPairKey[] {\n    const typed = units.filter((u) => u.unitType === type);\n    const pairs: ParsedPairKey[] = [];\n    for (let i = 0; i < typed.length; i++) {\n      for (let j = i + 1; j < typed.length; j++) {\n        const key = this.deps.pairing.pairKeyForUnits(typed[i], typed[j]);\n        const parsed = key ? this.deps.pairing.parsePairKey(key) : null;\n        if (parsed) {\n          pairs.push(parsed);\n        }\n      }\n    }\n    return pairs;\n  }\n\n  private async loadConfig(): Promise<DryConfig> {\n    this.config = await configStore.get(this.deps.repoPath);\n    return this.config;\n  }\n}","import crypto from \"node:crypto\";\nimport debug from \"debug\";\nimport { minimatch } from \"minimatch\";\nimport { LanguageExtractor } from \"../extractors/LanguageExtractor\";\nimport { IndexUnitExtractor } from \"../IndexUnitExtractor\";\nimport { IndexUnit, IndexUnitType } from \"../types\";\nimport { BLOCK_HASH_ALGO } from \"../const\";\n\nconst log = debug(\"DryScan:pairs\");\n\ntype UnitLike = Pick<IndexUnit, \"unitType\" | \"filePath\" | \"name\" | \"code\">;\n\nexport interface ParsedPairKey {\n  type: IndexUnitType;\n  left: string;\n  right: string;\n  key: string;\n}\n\n/**\n * Service for building and parsing pair keys with extractor-aware labeling.\n */\nexport class PairingService {\n  constructor(private readonly indexUnitExtractor: IndexUnitExtractor) {}\n\n  /**\n   * Creates a stable, order-independent key for two units of the same type.\n   * Returns null when units differ in type so callers can skip invalid pairs.\n   */\n  pairKeyForUnits(left: UnitLike, right: UnitLike): string | null {\n    if (left.unitType !== right.unitType) {\n      log(\"Skipping pair with mismatched types: %s vs %s\", left.unitType, right.unitType);\n      return null;\n    }\n    const type = left.unitType;\n    const leftLabel = this.unitLabel(left);\n    const rightLabel = this.unitLabel(right);\n    const [a, b] = [leftLabel, rightLabel].sort();\n    return `${type}|${a}|${b}`;\n  }\n\n  /**\n   * Parses a raw pair key into its components, returning null for malformed values.\n   * Sorting is applied so callers can compare pairs without worrying about order.\n   */\n  parsePairKey(value: string): ParsedPairKey | null {\n    const parts = value.split(\"|\");\n    if (parts.length !== 3) {\n      log(\"Invalid pair key format: %s\", value);\n      return null;\n    }\n    const [typeRaw, leftRaw, rightRaw] = parts;\n    const type = this.stringToUnitType(typeRaw);\n    if (!type) {\n      log(\"Unknown unit type in pair key: %s\", typeRaw);\n      return null;\n    }\n    const [left, right] = [leftRaw, rightRaw].sort();\n    return { type, left, right, key: `${type}|${left}|${right}` };\n  }\n\n  /**\n   * Checks whether an actual pair key satisfies a pattern, with glob matching for class paths.\n   */\n  pairKeyMatches(actual: ParsedPairKey, pattern: ParsedPairKey): boolean {\n    if (actual.type !== pattern.type) return false;\n    if (actual.type === IndexUnitType.CLASS) {\n      // Allow glob matching for class file paths.\n      const forward =\n        minimatch(actual.left, pattern.left, { dot: true }) &&\n        minimatch(actual.right, pattern.right, { dot: true });\n      const swapped =\n        minimatch(actual.left, pattern.right, { dot: true }) &&\n        minimatch(actual.right, pattern.left, { dot: true });\n      return forward || swapped;\n    }\n\n    // Functions and blocks use exact matching on canonical strings.\n    return (\n      (actual.left === pattern.left && actual.right === pattern.right) ||\n      (actual.left === pattern.right && actual.right === pattern.left)\n    );\n  }\n\n  /**\n   * Derives a reversible, extractor-aware label for a unit.\n   * Extractors may override; fallback uses a fixed format per unit type.\n   */\n  unitLabel(unit: UnitLike): string {\n    const extractor = this.findExtractor(unit.filePath);\n    const customLabel = extractor?.unitLabel?.(unit as IndexUnit);\n    if (customLabel) return customLabel;\n\n    switch (unit.unitType) {\n      case IndexUnitType.CLASS:\n        return unit.filePath;\n      case IndexUnitType.FUNCTION:\n        return this.canonicalFunctionSignature(unit);\n      case IndexUnitType.BLOCK:\n        return this.normalizedBlockHash(unit);\n      default:\n        return unit.name;\n    }\n  }\n\n  private findExtractor(filePath: string): LanguageExtractor | undefined {\n    return this.indexUnitExtractor.extractors.find((ex) => ex.supports(filePath));\n  }\n\n  private canonicalFunctionSignature(unit: UnitLike): string {\n    const arity = this.extractArity(unit.code);\n    return `${unit.name}(arity:${arity})`;\n  }\n\n  /**\n   * Normalizes block code (strips comments/whitespace) and hashes it for pair matching.\n   */\n  private normalizedBlockHash(unit: UnitLike): string {\n    const normalized = this.normalizeCode(unit.code);\n    return crypto.createHash(BLOCK_HASH_ALGO).update(normalized).digest(\"hex\");\n  }\n\n  private stringToUnitType(value: string): IndexUnitType | null {\n    if (value === IndexUnitType.CLASS) return IndexUnitType.CLASS;\n    if (value === IndexUnitType.FUNCTION) return IndexUnitType.FUNCTION;\n    if (value === IndexUnitType.BLOCK) return IndexUnitType.BLOCK;\n    return null;\n  }\n\n  private extractArity(code: string): number {\n    const match = code.match(/^[^{]*?\\(([^)]*)\\)/s);\n    if (!match) return 0;\n    const params = match[1]\n      .split(\",\")\n      .map((p) => p.trim())\n      .filter(Boolean);\n    return params.length;\n  }\n\n  private normalizeCode(code: string): string {\n    const withoutBlockComments = code.replace(/\\/\\*[\\s\\S]*?\\*\\//g, \"\");\n    const withoutLineComments = withoutBlockComments.replace(/\\/\\/[^\\n\\r]*/g, \"\");\n    return withoutLineComments.replace(/\\s+/g, \"\");\n  }\n}\n"],"mappings":"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","names":["upath","fs","path","fs","upath","crypto","glob","upath","upath","fs","upath","path","fs","crypto","upath","glob","fs","upath","Column","Entity","PrimaryColumn","PrimaryColumn","Column","Entity","fs","upath","path","fs","debug","Headers","fetch","fetch","__defProp","fields?: OllamaEmbeddingsParams","getEnvironmentVariable","requestOptions: OllamaCamelCaseOptions","snakeCasedOptions: Partial<OllamaOptions>","mapping: Record<keyof OllamaCamelCaseOptions, string>","texts: string[]","text: string","log","debug","path","fs","debug","path","fs","debug","log","debug","path","fs","log","debug","debug","log","debug","score","weights","hasParentClass","totalWeight","crypto","debug","minimatch","log","debug","minimatch","crypto","upath","fs"]}